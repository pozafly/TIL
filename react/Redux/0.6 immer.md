# immer

λ¦¬λ“€μ„μ—μ„ μƒνƒλ¥Ό μ—…λ°μ΄νΈ ν•  λ• λ¶λ³€μ„±μ„ μ§€μΌμ•Ό ν•κΈ° λ•λ¬Έμ— immerλ¥Ό μ“°κΈ° μ „μ—λ” spread μ—°μ‚°μμ™€ λ°°μ—΄μ λ‚΄μ¥ ν•¨μλ¥Ό μ΄μ©ν–λ‹¤. κ·Έλ¬λ‚ λ¨λ“μ μƒνƒκ°€ λ³µμ΅ν•΄μ§ μλ΅ λ¶λ³€μ„±μ„ μ§€ν‚¤κΈ°κ°€ κΉλ‹¤λ΅μ›μ§.

λ°°μ—΄μ€, `push`, `splice` λ“±μ ν•¨μλ¥Ό μ‚¬μ©ν•κ±°λ‚ nλ²μ§Έ ν•­λ©μ„ μ§μ ‘ μμ •ν•λ©΄ μ•λκ³ , `concat`, `filter`, `map` λ“±μ ν•¨μλ¥Ό μ‚¬μ©ν•΄μ•Ό ν•λ‹¤.

π“ Syntax

immer(produce)μ λ¬Έλ²•μ€,

- μ²«λ²μ§Έ νλΌλ―Έν„° : μμ •ν•κ³  μ‹¶μ€ μƒνƒ
- λ‘λ²μ§Έ νλΌλ―Έν„° : μ—…λ°μ΄νΈ μ •μ ν•¨μ(draft)

```js
import produce from 'immer';

const state = { number: 1, dontChangeMe: 2 };
const nextState = produce(state, draft => {
  draft.number += 1;
})
console.log(nextState);  // { number: 2, dontChangeMe: 2 }
```

<br/>

## λ¦¬λ“€μ„μ—μ„ Immer μ‚¬μ©ν•κΈ°

```sh
$ yarn add immer
```

redux-actions κ°€ μ μ©λμ–΄ μλ” todos λ¨λ“μ— μ μ©ν•΄λ³΄μ.

```js
// modules/todos.js

//...

const todos = handleActions(
  {
    [CHANGE_INPUT]: (state, { payload: input }) =>
      // ({ ...state, input })
      produce(state, (draft) => {
        draft.input = input;
      }),
    [INSERT]: (state, { payload: todo }) =>
      // ({
      //   ...state,
      //   todos: state.todos.concat(todo),
      // }),
      produce(state, (draft) => {
        draft.todos.push(todo);
      }),
    [TOGGLE]: (state, { payload: id }) =>
      // ({
      //   ...state,
      //   todos: state.todos.map((todo) =>
      //     todo.id === id ? { ...todo, done: !todo.done } : todo,
      //   ),
      // }),
      produce(state, (draft) => {
        const todo = draft.todos.find((todo) => todo.id === id);
        todo.done = !todo.done;
      }),
    [REMOVE]: (state, { payload: id }) =>
      // ({
      //   ...state,
      //   todos: state.todos.filter((todo) => todo.id !== id),
      // }),
      produce(state, (draft) => {
        const index = draft.todos.findIndex((todo) => todo.id === id);
        draft.todos.splice(index, 1);
      }),
  },
  initialState,
);
```

immerλ¥Ό μ‚¬μ©ν•λ‹¤κ³  ν•΄μ„ λ¨λ“  μ—…λ°μ΄νΈ ν•¨μμ— immerλ¥Ό μ μ©ν•  ν•„μ”λ” μ—†μ. μΌλ° μλ°”μ¤ν¬λ¦½νΈλ΅ μ²λ¦¬ν•λ” κ²ƒμ΄ λ” νΈν•  λ•λ”, immerλ¥Ό μ μ©ν•μ§€ μ•μ•„λ„ λ¨. μλ¥Ό λ“¤μ–΄ μ„ μ½”λ“μ—μ„ TOGGLEμ„ μ μ™Έν• μ—…λ°μ΄νΈ ν•¨μλ“¤μ„ immerλ¥Ό μ“°μ§€ μ•λ” μ½”λ“κ°€ μ¤νλ ¤ λ” μ§§κΈ° λ•λ¬Έμ— μ΄μ „ ν•νƒλ¥Ό μ μ§€ν•λ” κ²ƒλ„ λ¬΄λ°©ν•¨.

<br/>

## immerμ™€ ν•¨μν• μ—…λ°μ΄νΈ

`useState` λ¥Ό μ‚¬μ©ν•  λ•, ν•¨μν• μ—…λ°μ΄νΈλΌλ” κ²ƒμ„ μ‚¬μ©ν•  μ μμ—λ‹¤. μλ¥Ό λ“¤λ©΄,

```js
const [todo, setTodo] = useState({
  text: 'hello',
  done: false,
});

const onClick = useCallback(() => {
  setTodo(todo => ({
    ...todo,
    done: !todo.done
  }));
}, []);
```

μ΄λ ‡κ² `setTodo` ν•¨μμ— μ—…λ°μ΄νΈλ¥Ό ν•΄μ£Όλ” ν•¨μλ¥Ό λ„£μμΌλ΅μ¨, λ§μ•½ `useCallback` μ„ μ‚¬μ©ν•λ” κ²½μ° λ‘ λ²μ§Έ νλΌλ―Έν„°μΈ `deps` λ°°μ—΄μ— `todo` λ¥Ό λ„£μ§€ μ•μ•„λ„ λλ‹¤.

μ΄λ ‡κ² ν•¨μν• μ—…λ°μ΄νΈλ¥Ό ν•λ” κ²½μ°μ—, immerλ¥Ό μ‚¬μ©ν•λ©΄ λ” νΈν•κ² μ½”λ“λ¥Ό μ‘μ„±ν•  μ μκ² λ¨.

λ§μ•½ `produce` ν•¨μμ— λ‘ κ°μ νλΌλ―Έν„°λ¥Ό λ„£κ² λλ‹¤λ©΄ μ²« λ²μ§Έ νλΌλ―Έν„°μ— λ„£μ€ μƒνƒλ¥Ό λ¶λ³€μ„±μ„ μ μ§€ν•λ©΄μ„ μƒλ΅μ΄ μƒνƒλ¥Ό λ§λ“¤μ–΄μ£Όμ§€λ§, λ§μ•½ **μ²« λ²μ§Έ νλΌλ―Έν„°λ¥Ό μƒλµν•κ³ ** `λ°”λ΅ μ—…λ°μ΄νΈ ν•¨μλ¥Ό λ„£μ–΄`μ£Όλ©΄, λ°ν™ κ°’μ€ **μƒλ΅μ΄ μƒνƒκ°€ μ•„λ‹ μƒνƒλ¥Ό μ—…λ°μ΄νΈ ν•΄μ£Όλ” ν•¨μ**κ°€ λλ‹¤.

```js
const todo = {
  text: 'hello',
  done: false,
};

const updater = produce(draft => {
  draft.done = !draft.done;
});

const nextTodo = updater(todo);
console.log(nextTodo); // { text: 'hello', done: false }
```

κ²°κµ­ `produce` κ°€ λ°ν™ν•λ” κ²ƒμ΄ μ—…λ°μ΄νΈ ν•¨μκ°€ λκΈ° λ•λ¬Έμ— `useState` μ μ—…λ°μ΄νΈ ν•¨μλ¥Ό μ‚¬μ©ν•  λ• λ‹¤μκ³Ό κ°™μ΄ κµ¬ν„ν•  μ μκ² λλ‹¤.

```js
const [todo, setTodo] = useState({
  text: 'hello',
  done: false,
});

const onClick = useCallback(() => {
  setTodo(
    produce(draft => {
      draft.done = !draft.done;
    })
  );
}, []);
```

