# 컴파일링

C로 작성된 텍스트 형식의 파일은 컴파일시 구체적으로 어떤 단계를 거쳐 컴퓨터가 해석 가능한 파일로 변환되는가?

## 핵심 단어

- 컴파일링
- 어셈블링
- 링킹

```c
#include <stdio.h>

int main(void)
{
  printf("hello, world\n");
}
```

코드를 `$ clang hello.c` 로 컴파일하고, `./a.out` 명령으로 프로그램을 실행할 때 이 과정은 컴퓨터가 이해하는 0과 1로 가득찬 파일 a.out을 생성하여 실행 가능하게 한다.

만약 a.out과 다른 이름(hello)로 컴파일 할 때는 clang에 또 하나의 프로그램(-lcs50)이 필요했다. 그래야 clang이 실행되었다.

`$ clang -o hello hello.c -lcs50`. 이는 clang에게 CS50 라이브러리에 있는 모든 0과 1을 여기에 연결하라는 의미다.

make 명령어나, clang 명령어를 사용해 프로그램을 실행할 때 아래 4개의 단계를 거친다.

- 전처리
- 컴파일링
- 어셈블링
- 링킹

<br />

## 전처리(precompile)

전처리는 전처리기에 의해 수행된다. `#` 으로 시작되는 C 소스코드는 전처리기에게 실질적인 **컴파일이 이루어지기 전에 무언가를 실행**하라고 알려준다.

예를 들어, #include는 전처리기에 다른 파일의 내용을 포함시키라고 알려준다. 코드에 `#include`와 같은 줄을 포함하면 전처리기는 새로운 파일을 생성하는데 이 파일은 여전히 C 소스코드 형태이며 stdio.h 파일의 내용이 #include 부분에 포함된다.

## 컴파일(Compile)

컴파일러라고 불리는 프로그램은 C 코드를 **어셈블리어라는 저수준 프로그래밍 언어로 컴파일**한다.

어셈플리는 C보다 연산의 종류가 훨씬 적지만, 여러 연산들이 함께 사용되면 C에서 할 수 있는 모든 것들을 수행할 수 있다. C를 어셈블리 코드로 변환시켜줌으로써 컴파일러는 컴퓨터가 이해할 수 있는 언어와 최대한 가까운 프로그램으로 만들어준다. 컴파일이라는 용어는 소스 코드에서 오브젝트 코드로 변환하는 전체 과정을 통틀어 말하기도 하지만, 구체적으로 전처리한 소스 코드를 어셈블리 코드로 변환시키는 단계를 말하기도 함.

## 어셈블(Assemble)

어셈블 단계는 **어셈블리 코드를 오브젝트 코드로 변환 시키는 것**이다. 컴퓨터의 중앙처리장치가 프로그램을 어떻게 수행해야 하는지 알 수 있는 명령어 형태인 연속된 0과 1들로 바꿔주는 작업. 이 작업은 어셈블러라는 프로그램이 수행한다. 소스 코드에서 오브젝트 코드로 컴파일 되어야 할 파일이 딱 한 개라면, 컴파일 작업은 여기서 끝이 난다. 그러나 그렇지 않으면 링크라 불리는 단계가 추가된다.

## 링크(Link)

만약 프로그램이 (math.h나 cs50.h 와 같은 라이브러리를 포함해) 여러 개의 파일로 이루어져 있어 하나의 오브젝트 파일로 합쳐져야 한다면 링크라는 컴파일의 마지막 단계가 필요하다. 링커는 **여러 개의 다른 오브젝트 코드 파일을 실행 가능한 하나의 오브젝트 코드 파일로 합쳐**준다. 예를 들어, 컴파일 하는 동안에 CS50 라이브러리를 링크하면 오브젝트 코드는 `GetInt()`나 `GetString()` 같은 함수를 어떻게 실행할 지 알 수 있게 된다.

---

이 네 단계를 거치면 최종적으로 실행 가능한 파일이 완성된다.
