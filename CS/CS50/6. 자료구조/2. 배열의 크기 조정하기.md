# 배열의 크기 조정하기

메모리는 사물함과 같은 구조다. 사용하고자 하는 사물함 개수를 한 번 정한 이후에는, 공간이 모자란다고 해서 주변의 사물함을 마음대로 더 사용할 수는 없다. 이미 다른 목적으로 사용되고 있을 수 있기 때문이다. 일정한 크기의 메모리가 할당되어 있는 상황에서, 그 크기를 늘리는 일은 단순하지 않다. 포인터와 malloc의 개념을 응용해, 이미 정의된 배열의 크기를 바꿔보자.

## 핵심 단어

- malloc
- realloc

---

<img width="1500" alt="image" src="https://github.com/pozafly/TIL/assets/59427983/526b6ad4-54f5-432a-b129-3b9f30e59b58">

배열이 위와 같이 123 공간에 크기가 고정된 채로 할당되어 있다. 근데 4개를 쓰고 싶다면 어떻게 해야하나?

가장 아래 빈 공간에 123을 넣고 공간을 새로 할당해주면 된다. 즉, 주소를 새롭게 빈 공간에 지정해주면 된다. 배열의 길이가 고정되어 있었지만, 다시 메모리 할당을 통해 배열 길이를 수정해줄 수 있는 것이다.

1. 123을 옮길 때는 값을 일일이 복사해서 새로운 공간으로 할당해준다.
2. 그리고, 기존 123 공간은 free로 메모리 할당 해제를 해주면 된다.
3. 후에 뒤에 있는 공간에 4를 할당해주면 된다.

하지만, 이런 과정은 효율적이지 않다. 복사하는 과정을 일일이 해주어야 하기 때문이다. 많은 과정이 있기 때문임.

`O(n)` 시간 복잡도가 걸린다. 사물함의 갯수에 따라 작업을 해주어야 하기 때문이다. 즉, 배열의 키기 n만큼의 실행 시간임.

```c
#include <stdio.h>
#include <stdlib.h>

int main(void)
{
    //int 자료형 3개로 이루어진 list 라는 포인터를 선언하고 메모리 할당
    int *list = malloc(3 * sizeof(int));

    // 포인터가 잘 선언되었는지 확인
    if (list == NULL)
    {
        return 1;
    }

    // list 배열의 각 인덱스에 값 저장
    list[0] = 1;
    list[1] = 2;
    list[2] = 3;

    //int 자료형 4개 크기의 tmp 라는 포인터를 선언하고 메모리 할당
    int *tmp = malloc(4 * sizeof(int));

    if (tmp == NULL)
    {
        return 1;
    }

    // list의 값을 tmp로 복사
    for (int i = 0; i < 3; i++)
    {
        tmp[i] = list[i];
    }

    // tmp배열의 네 번째 값도 저장
    tmp[3] = 4;

    // list의 메모리를 초기화
    free(list);

    // list가 tmp와 같은 곳을 가리키도록 지정
    list = tmp;

    // 새로운 배열 list의 값 확인
    for (int i = 0; i < 4; i++)
    {
        printf("%i\n", list[i]);
    }

    // list의 메모리 초기화
    free(list);
}
```

위와 동일한 작업을 `realloc` 이라는 함수를 이용해 수행할 수도 있다.

```c
#include <stdio.h>
#include <stdlib.h>

int main(void)
{
    int *list = malloc(3 * sizeof(int));
    if (list == NULL)
    {
        return 1;
    }

    list[0] = 1;
    list[1] = 2;
    list[2] = 3;

    // tmp 포인터에 메모리를 할당하고 list의 값 복사
    int *tmp = realloc(list, 4 * sizeof(int));
    if (tmp == NULL)
    {
        return 1;
    }

    // list가 tmp와 같은 곳을 가리키도록 지정
    list = tmp;

    // 새로운 list의 네 번째 값 저장
    list[3] = 4;

    // list의 값 확인
    for (int i = 0; i < 4; i++)
    {
        printf("%i\n", list[i]);
    }

    //list 의 메모리 초기화
    free(list);
}
```

