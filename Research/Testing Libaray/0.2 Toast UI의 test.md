# Toast UI의 test

> [출처](https://ui.toast.com/fe-guide/ko_TEST)

## 자바스크립트 테스트 도구

### 테스트 러너: 테스트를 구동할 수 있는 환경을 제공

- **Karma**와 같이 브라우저에서 직접 코드를 실행하는 러너.
- **Jest**와 같이 Node.js 환경에서 코드를 실행하는 러너.
  - Node.js 기반 테스트 러너들은 굳이 러너의 실행 환경과 코드의 실행 환경을 구분할 필요가 없기 때문에 대부분 테스트 프레임 워크와 통합된 형태로 제공됨.

### 단언(assertion) 라이브러리

- 단언은 개별 테스트가 통과하기 위한 조건을 명확하게 기술하기 위해 사용됨.
- 보통은 테스트 프레임워크에서 다양한 방식의 단언 API를 기본으로 제공
  - 단, **Mocha**의 경우에만 Chai 와 같은 별도의 단언 라이브러리를 사용하도록 권장함.

### 테스트 더블(test double) 라이브러리

- 실제 객체 대신 테스트를 위해 동작하는 객체를 말함.
- 단언과 마찬가지로 테스트 더블을 위함 함수도 테스트 프레임워크에서 기본 제공되는 경우 대부분.
  - 하지만, **Mocha** 경우에만 Sinon.js 등의 별도 라이브러리를 사용 권장.
- **Jest**에서는 객체를 모듈 단위로 사용할 수 있는 기능 제공.
- **Jasmine**의 Clock이나, Sinon.js의 Lolex와 같은 도구는 JS의 타이머 API도 직접 제어 가능.
- Axios 경우 [별도로 구현된 Mock 라이브러리](https://github.com/ctimmerm/axios-mock-adapter)를 제공.

## 테스트 실행 환경

JS의 테스트는 브라우저 환경과 Node.js 환경 모두에서 실행할 수 있음.

### 브라우저

- E2E 테스트 도구를 제외한다면 **Karma** 사용하는 것이 유일한 방법.
- **Karma**는 테스트 러너의 역할만 함. 따라서 별도의 테스트 프레임워크가 필요. 보통 **Jasmine** 권장.
- 장점
  - 실 브라우저 환경에서 테스트. 따라서, 네트워크 IO, 렌더링 엔진 등 테스트할 수 있다.
  - **Selenium** 등의 도구를 사용해 동일한 테스트코드를 다양한 환경(운영체제, 브라우저) 테스트를 실행할 수 있기 때문에, 브라우저 호환성 및 기기 환경에 대한 테스트도 진행 가능.
- 단점
  - 브라우저 프로세스가 Node.js 프로세스보다 무거움. 초기 구동속도 느림.
    - 따라서, 브라우저 런처 등 추가로 설치해줘야 함.
    - 또 크로스 브라우징 테스트 등을 위해 별도 환경을 구축하고 유지보수 하는 비용이 든다.
    - 단, Browser Stack이나, Sauce Lab 등 외부 서비스를 사용해 자동 구축 가능.
  - 따라서, 개발 단계에서 헤드리스 브라우저를 사용해 빠른피드백, 배포시 크로스 브라우징 테스트 함.

### Node.js

- **Mocha**, **Jest** 가 많이 쓰임.
- 테스트 러너, 테스트 프레임워크가 통합되어 있어 간단.
- 장점
  - 속도 빠름.
  - 모듈 단위 테스트 가능. 즉, Node.js 환경에서 import 구문을 사용해 가져옴.
- 단점
  - 브라우저의 모든 API를 제대로 활용 불가능.
    - Node.js에는 DOM, BOM등의 API가 없기 때문.
    - 이 문제를 해결하기 위해 **JSDom** 과 같은 라이브러리를 사용, 브라우저 환경을 가상으로 구현하는 방식을 사용하지만, 100% 구현하지 못함.
    - 예를 들면 렌더링 엔진을 갖고 있지 않아 UI 요소 레이아웃에 대한 테스트 불가능. 네비게이션 관련 동작 불가능. 크로스 부라우징 테스트도 불가능.

### 브라우저 vs Node.js

1. 크로스 브라우징 테스트가 "반드시" 필요한 경우 브라우저 환경을 사용한다.
   - 단, 최근엔 크로스 브라우징 테스트 필요성 감소.
     - 왜냐면, Babel 등 트랜스 파일러 사용, DOM을 직접 조작하는 일은 React, Vue가 해줌.
2. 브라우저의 실제 동작(렌더링, 네트워크 IO, 내비게이션 등)에 대한 테스트가 필요한 경우 브라우저 환경을 사용한다.
3. 그 외의 경우 Node.js 환경을 사용한다.

권장 도구:

- 브라우저: Karma + Jasmine
- Node.js: Jest

## Jasmine

- 프레임워크.
  - **Mocha**와 비교됨.
- BDD(Behavior Driven Development) 스타일의 단언 API 사용.
- Node.js, 브라우저 환경 모두 사용 가능.
- 타이머제어, 비동기 테스트 가능.

## Karma

- 위의 **Jasmine** 으로 작성된 테스트 코드를 브라저에서 동작.(테스트 러너이기 때문.)
  - 로컬 웹 서버를 구동 후 테스트에 필요한 소스 코드 및 리소스 모두 로드하는 HTML 페이지 생성.
  - 지정된 브라우저 프로세스를 자동으로 실행한 후 앞서 생성한 웹페이지의 URL에 접속함.
  - 브라우저 실행된 결과를 받아와 리포터를 사용 다양한 형식으로 출력.
- 작성한 테스트 코드의 커버리지는 **Istanbul** 라이브러리를 사용해 측정 가능.
- **Karma**와 **Selenium WebDriver** 를 연결해 원격 PC를 통해 크로스 브라우징 테스트 가능.

## Jest

- Node.js 환경에서 실행
- 내부적으로 Jasmine 스타일의 단언 API를 사용.
- 쉬운 설치 및 실행.
- 테스트 러너의 기능, 단언, 테스트 더블, 코드 커버리지 등 테스트에 필요한 모든 기능을 지원.
- jsdom 내장.
  - DOM이나 window 객체의 API를 사용할 수 없으므로 가상으로 만들어주는.
- 스냅샷 테스트
  - 객체 내부의 상태를 그대로 파일로 저장해놓고, 다음 테스트에서 객체의 현재 상태가 이전에 저장된 상태와 다른지 비교하는 테스트.
  - Jest의 상징과 같은 기능.
  - 주로 리액트의 가상돔 구조를 비교하기 위해 사용됨.
- 테스트 파일 필터링
  - 테스트할 대상 파일을 구체적 지정 기능.
  - Jest는 기본적으로 Git과 같은 버전 관리 도구와 연동해 마지막 커밋 이후 변경 사항이 있는 파일만을 테스트 대상에 포함 함.
  - 따라서 이미 검증된 파일에 대해 불필요한 테스트를 매번 실행하는 것을 방지.

> 📌E2E Test와 크로스 브라우징 테스트를 혼동하지 말자.
>
> Karma는 테스트 러너로 실행 환경이다. 따라서 가짜 브라우저를 생성해주고, 생성된 브라우저 위에 Jasmine 같은 Test 프레임워크가 테스트할 수 있게 해주는 것임. 여기서 Karma로 다양한 환경의 브라우저로 테스트 가능한거임.
>
> 그리고, E2E Test 자체는 브라우저 환경에서 **'사용자 관점'** 으로 하나하나 동작이 되는지를 테스트 해주는 것임.

## E2E 테스트

**Cypress**, **TestCafe** 등 **Selenium Webdriver**.

### Webdriver

- 다양한 브라우저 지원. (크롬, IE, 파폭, 사파리 등)
- JSON 기반 프로토콜임.
- Node.js 기반 테스트 프레임워크가 있음.
  - [Protractor](http://www.protractortest.org/): Angular 프로젝트를 위한 테스트 프레임워크
  - [WebdriverJS](https://github.com/SeleniumHQ/selenium/wiki/WebDriverJs): Selenium Webdriver의 정식 Node.js 구현체이며, 낮은 수준(Low-level)의 API를 제공한다.
  - [NightWatch](http://nightwatchjs.org/): Mocha 기반의 테스트 러너와 직관적인 API, CI 서버 통합 등의 다양한 기능을 지원한다.
  - [WebdriverIO](http://webdriver.io/): 테스트 러너, 정적 웹 서버, CI 서버 통합, REPL 인터페이스 등 다양한 기능을 지원하며 커뮤니티가 가장 잘 활성화되어 있다.
- 하지만 WebDriver는 앞서 설명한 E2E 테스트의 단점을 그대로 갖고 있기 때문에 테스트를 작성하거나 유지 보수하는데 많은 비용이 듬, 이로 인해 개발자들이 개발 단계에서 사용하는 테스트 도구로써는 사실상 널리 활용되지 못하고 있다.

### Cypress

- Webdriver와는 다르게 실제 어플리케이션과 테스트 코드를 동일한 브라우저에서 실행하는 방식을 취함.
- HTTP 등을 사용한 프로세스 사이의 통신이 필요 없이 동일한 프로세스 내부에서 테스트를 실행.
  - 따라서 빠르고 안정적.
  - 브라우저 기반 GUI 사용, 테스트의 실행 상태를 확인, 디버깅 가능.
- Webdriver와는 전혀 다른 목적. 정확히 FE 개발자들이 개발 단계에서 사용하기에 최적화 됨.
