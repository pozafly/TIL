# Rebase

## ê°œë…

- rebaseê°€ í•„ìš”í•œ ìƒí™©ì„ ì˜ ì´í•´í•´ì•¼í•¨.
  - base : commitì´ ìŒ“ì´ëŠ” ê²ƒ
  - rebase : ê¸°ë³¸ì ìœ¼ë¡œ ìŒ“ì¸ commitì„ ìˆ˜ì • í›„, ê¸°ë³¸ commitì„ ì¬êµ¬ì„± í•œë‹¤ëŠ” ëœ».
- ë² ì´ìŠ¤ë§Œ ë°”ê¾¸ì. ìµœì‹  ì—­ì‚¬ë¡œ ë² ì´ìŠ¤ ì—…ë°ì´íŠ¸.
- ì™œ í•˜ëƒ?
  - ë‚´ê°€ fork í•œ ì €ì¥ì†Œì—ì„œ ì†ŒìŠ¤ë¥¼ ìˆ˜ì •í•˜ê³  ìˆëŠ”ë°, ë‹¤ë¥¸ ì‚¬ëŒë„ ìì‹ ì´ forkí•œ repoì—ì„œ ìˆ˜ì •ë˜ì–´ PRì„ ë‚ ë ¤ì„œ ì›ë³¸ repoê°€ ë³€ê²½ì´ ëœ ìƒí™©ì´ë‹¤.
  - ê·¸ëŸ¬ë©´, ë‚´ local repoì˜ base, ì¦‰, ë‚´ repoì˜ commit ë‚´ì—­ë„ ë°”ë€Œì–´ì•¼ ëœë‹¤.(local repo, fork repo ëª¨ë‘)
  - ë‚´ ë‚´ì—­ì´ ë°”ë€Œì–´ì•¼ ì›ë³¸ ì†ŒìŠ¤ì™€ ë‚´ local ì†ŒìŠ¤ê°€ ë™ì¼í•˜ê²Œ ë˜ì–´ ë‹¤ì‹œ PRì„ ë‚ ë¦´ ìˆ˜ ìˆëŠ” ìƒíƒœê°€ ë˜ê¸° ë•Œë¬¸ì´ë‹¤.

<br/>

<br/>

## ë°©ë²•

- ë¨¼ì € ìµœì‹  ì—­ì‚¬ë¥¼ ê°€ì ¸ì™€ì•¼ í•¨. fetch.
  - git pull = fetch + merge ì„.
  - ë‚´ê°€ localì—ì„œ baseê°€ ë°”ë€Œë©´ì„œ merge commitì´ ìƒê¸°ëŠ” ê²ƒì´ê¸° ë•Œë¬¸ì— mergeë¥¼ ê°•ì œë¡œ í•˜ì§€ë§ê³  fetchë¥¼ ë¨¼ì € í•œë‹¤ëŠ” ë§ì„.
  - `git fetch upstream master`
- ì´ì œ rebase ë¥¼ í•  ìˆ˜ ìˆìŒ.  2ë‹¨ê³„ê°€ ìˆìŒ.
  - ì‘ì—… ì¤‘ ì»¤ë°‹(push í•˜ê¸° ì „ commit)ì„ rebase.
  - `git rebase upstream/master`
  - í›„ì— force push í•´ì•¼ í•œë‹¤. ë‚˜ì˜ fork í•œ ì €ì¥ì†Œì—ë§Œ.

ğŸ“Œ ì •ë¦¬í•˜ìë©´, 3ë‹¨ê³„ì„

- ëˆ„êµ°ê°€ mergeí•œ ì›ë³¸ repoì—ì„œ ë‚´ local repoì— fetch.
- ë‚´ local repoì—ì„œ rebase.
- forkí•œ ì›ê²© repoì— force push.

ğŸ“Œ ê·¸ë¦¬ê³ , rebase ì‹œ ë‚´ë¶€ì ìœ¼ë¡œ ì¼ì–´ë‚˜ëŠ” ì¼ì€ 3ë‹¨ê³„ì„.

- `rewind`(ë˜ê°ê¸°), `rebase`(ë² ì´ìŠ¤ ê°±ì‹ ), `continue`(rebase ë‚´ìš© ì €ì¥)
- 2ë‹¨ê³„ì¸, rebase ê°±ì‹  ë•Œ ì›ì¹™ì ìœ¼ë¡œëŠ” ë¬¸ì œê°€ ìˆìœ¼ë©´ ì•ˆëœë‹¤.
  - ë§Œì•½ ë¬¸ì œê°€ ìˆë‹¤ë©´ ì›ë³¸ repoì—ì„œ ê´€ë¦¬ê°€ ì˜ëª»ëœ ê²ƒì´ë‹¤.
  - ë³´í†µ, íŒ€ í”„ë¡œì íŠ¸ì— ì˜¤ë„ˆê°€, ì›ë³¸ repoì˜ baseë¥¼ ê±´ë“œë¦° ê²ƒì´ë‹¤.(ê³¼ê±°ì˜ baseë¥¼ ê±´ë“¤ì¸ ê²½ìš°)
  - ê·¸ë ‡ê²Œ ë˜ë©´ 2ê³¼ì •ì—ì„œ ëª¨ë“  íŒ€ì˜ ì†ŒìŠ¤ì—ì„œ ë¬¸ì œê°€ ìƒê¸´ë‹¤.
- ì´ì œ 3ë‹¨ê³„ì—ì„œë„ ë¬¸ì œê°€ ìƒê¸´ë‹¤.
  - ì™œ? ë‚´ repoì—ì„œì˜ ì†ŒìŠ¤ì™€ fetch í•´ì„œ ê°€ì ¸ì˜¨ ì†ŒìŠ¤ê°€ ë‹¤ë¥´ê¸° ë•Œë¬¸.
  - ì—¬ê¸°ì„œëŠ” rebaseì—ì„œ í•  ìˆ˜ ì—†ëŠ” ì‘ì—…ì´ë‹¤.
  - ê°œë°œìê°€ ì•Œì•„ì„œ ìˆ˜ë™ìœ¼ë¡œ ì¶©ëŒì„ ì¡ì•„ì¤˜ì•¼ í•œë‹¤. ì¦‰, ì»¤ë°‹ ì •ë¦¬ë¥¼ í•´ì„œ ì˜¬ë ¤ì¤˜ì•¼ í•˜ëŠ” ë¶€ë¶„ì„.
  - ì´ëŸ° ì¶©ëŒì´ ìì£¼? No.
    - ëŒ€ë¶€ë¶„ì€ rebase í•˜ë©´ ëë‚œë‹¤.
    - ì´ìœ ëŠ”, git ë¬¸ì œê°€ ì•„ë‹ˆë¼, ì„¤ê³„ ìì²´(ëª¨ë“ˆí™”)ë¥¼ ì˜ ì¡ì•„ë‘ê¸° ë•Œë¬¸ì— íŒŒì¼ì´ ì˜ ë‚˜ëˆ ì ¸ìˆê¸° ë•Œë¬¸ì—.
    - ì¦‰, í•œ íŒŒì¼ì— ëŒ€í•´ ëª‡ ì‚¬ëŒì´ ë™ì‹œ ì‘ì—…ì€ ë§ì•„ë´ì•¼ 3ëª….

<br/>

<br/>

## ì¤€ë¹„

### Fork ì €ì¥ì†Œì™€ ì˜¤í”ˆì†ŒìŠ¤ Github ì €ì¥ì†Œ ì„¤ì •

- originì™¸ì— upstream ì €ì¥ì†Œë¥¼ remoteì— ì¶”ê°€í•  ê²ƒì„.

```shell
# ì˜¤í”ˆì†ŒìŠ¤ ê³µì‹ GitHub í”„ë¡œì íŠ¸ URL
# upstream ìœ¼ë¡œ ë“±ë¡ í•˜ê¸°
$ git remote add upstream https://github.com/taeung/pytorch-example

# origin: ë‚˜ì˜ Fork ì €ì¥ì†Œ GitHub URL
# upstream: ì˜¤í”ˆì†ŒìŠ¤ ê³µì‹ GitHub URL (ë˜ëŠ” íŒ€í”„ë¡œì íŠ¸ URL)
$ git remote -v
origin  https://github.com/ë‚˜ì˜ID/pytorch-example.git (fetch) 
origin  https://github.com/ë‚˜ì˜ID/pytorch-example.git (push)
upstream        https://github.com/ì›ë³¸ID/pytorch-example.git (fetch)
upstream        https://github.com/ì›ë³¸ID/pytorch-example.git (push)
```

ğŸ“Œ `origin` vs `upstream`

- ì–´ë–¤ ë•ŒëŠ” remote originì´ë¼ê³  í•˜ê³ , ì–´ë–¤ ë•ŒëŠ” remote upstream ì´ë¼ê³  í•¨.
- Github `fork` ë§¥ë½ì—ì„œ ì´í•´ë˜ì–´ì•¼ í•¨.
  - ë‚´ê°€ ë‹¤ë¥¸ ì‚¬ëŒì˜ repoë¥¼ fork í•´ì™”ì„ ë•Œ, upstreamì€ ì¼ë°˜ì ìœ¼ë¡œ ì˜¤ë¦¬ì§€ë„ repo(ë‹¤ë¥¸ ì‚¬ëŒì˜ repo)ë¥¼ ì˜ë¯¸.
  - originì€ ë‚´ forkë¥¼ ì˜ë¯¸. repoê°€ cloneë  ë•Œ, default remoteëŠ” originì´ë¼ê³  ë¶ˆë¦°ë‹¤.
- ì—¬ê¸°ì„œ ì˜¤ë¦¬ì§€ë„ repo(ë‹¤ë¥¸ ì‚¬ëŒì˜ ì›ë³¸ repo)ì˜ ë³€í™”ë¥¼ ì¶”ì í•˜ê³  ì‹¶ìœ¼ë©´ upstreamì´ë¼ëŠ” ì´ë¦„ì˜ ë¦¬ëª¨íŠ¸ë¥¼ ì¶”ê°€í•´ì•¼í•¨.
- fork í•œ ë‚´ repoì— ì»¨íŠ¸ë¦¬ë·°íŠ¸ í•˜ë ¤ë©´, pull, pushë¡œ í•˜ë©´ë˜ê³ , ì˜¤ë¦¬ì§€ë„ repo(ë‹¤ë¥¸ ì‚¬ëŒì˜ ì›ë³¸ repo)ì— ì»¨íŠ¸ë¦¬ë·°íŠ¸ í•˜ë ¤ë©´, fetch, Pull-Requestë¥¼ ë‚ ë¦¬ë©´ ëœë‹¤.

<br/>

<br/>

## ì‹¤ìŠµ

### ì›ë³¸ repo ìµœì‹  commitìœ¼ë¡œ Base ì—…ë°ì´íŠ¸

```shell
# ê³µì‹ upstream ì €ì¥ì†Œì—ì„œ ìµœì‹  commit history ê°€ì ¸ì˜¤ê¸°
$ git fetch upstream master

# ìµœì‹  commit history ê¸°ì¤€ìœ¼ë¡œ ë² ì´ìŠ¤ ê°±ì‹  (rebase)
$ git rebase upstream/master

# Fork í•œ ì €ì¥ì†Œ(GitHub)ë„ ìˆ˜ì •í•˜ê¸° (PR ìë™ ê°±ì‹ )
$ git push --force origin [ë¸Œëœì¹˜ ëª…]
or
$ git push --f origin [ë¸Œëœì¹˜ ëª…]
```

ğŸ“Œ ì´ë ‡ê²Œ **force push**ë¥¼ í•˜ê²Œ ë˜ë©´, ê¸°ì¡´ì— ë‚´ê°€ ë‚¨ê²¨ë‘” PRì´ ìˆì„ ê²½ìš° ìë™ìœ¼ë¡œ ê°±ì‹ ëœë‹¤.

ğŸ“Œ ë˜í•œ ê·¸ëƒ¥ PRì„ ìˆ˜ì •í•˜ê³  ì‹¶ì„ ë•Œë„, **force push**ë¥¼ ì‚¬ìš©í•œë‹¤.

ğŸ“Œ ìœ„ì˜ 2ë²ˆì§¸ ëª…ë ¹ì–´ì˜ `upstream/master` ì´ ê²ƒì€ gitì—ì„œ ìë™ìœ¼ë¡œ ë§Œë“¤ì–´ì¤€ ë¸Œëœì¹˜ë‹¤.

<br/>

<br/>

## Interactive Rebasing

- ê³¼ê±° ì‹œì ìœ¼ë¡œ ëŒì•„ê°€ì„œ ì†ŒìŠ¤ í™•ì¸ & ì»´íŒŒì¼í•´ì„œ ëŒë ¤ë³¼ ìˆ˜ ìˆë‹¤.

### commit ê³¼ê±° ì‹œì ìœ¼ë¡œ ë˜ê°ê¸°(rewind)

```shell
# Rebase ì‹¤ìŠµí•  GitHub ì €ì¥ì†Œ ì†ŒìŠ¤í´ë” ë‹¤ìš´ë°›ê³  ì´ë™
$ cd /workspace
$ git clone https://github.com/taeung/git-training 
$ cd git-training

# ê°€ì¥ ì˜¤ë˜ëœ commit ë‘ë²ˆì§¸ë¡œ ë˜ê°ê¸° 
# ë‘ë²ˆì§¸ë¡œ ê°€ì¥ ì˜¤ë˜ëœ commit ì˜ "pick" ê¸€ìë¥¼ "edit" ìœ¼ë¡œ ìˆ˜ì •í•˜ê¸°
# nano í¸ì§‘ê¸° ì €ì¥: ctrl + o 
# nano í¸ì§‘ê¸° ë‚˜ê°€ê¸°: ctrl + x
$ git rebase -i --root

# ë˜ê°ê¸°(rewind) í•œ commit ë¦¬ìŠ¤íŠ¸ í™•ì¸í•˜ê¸°
$ git log --oneline

# rebase interactive ìƒíƒœ (ë˜ê°ì€ ìƒíƒœ) í™•ì¸
$ git status

# ì°¸ê³ : --root ëŒ€ì‹  ìµœì‹  commit ê¸°ì¤€ìœ¼ë¡œ HEAD~10 10ê°œì¤‘ì—ì„œ ì„ íƒë„ ê°€ëŠ¥í•˜ë‹¤
```

<br/>

### commit ë‹¤ì‹œ í˜„ì¬ ì‹œì ìœ¼ë¡œ í’€ê¸°(continue)

```shell
# ë˜ê°ì€ ë‚´ìš© í’€ê¸°(continue) ì´ì „ ìƒíƒœ í™•ì¸
$ git log --oneline

# ë˜ê°ì€ ë‚´ìš© í’€ê¸°(continue)
$ git rebase --continue

# ë˜ê°ì€ ë‚´ìš© í’€ê¸°(continue) ì´í›„ ìƒíƒœ í™•ì¸
$ git log --oneline

# ì°¸ê³ : rebase ê³¼ì •ì„ ì·¨ì†Œí•˜ë ¤ë©´ --abort ì˜µì…˜ì„ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.  
```

---

ğŸ“Œ rebaseì—ì„œ, abortì™€ continueì˜ ì°¨ì´ì 

- git rebase abort : ë¦¬ë² ì´ìŠ¤ ì§„í–‰ ì·¨ì†Œ
- git rebase continue : ë¦¬ë² ì´ìŠ¤ë¥¼ ë§ˆì¹œ í›„ ì €ì¥ & ì§„í–‰

<br/>

<br/>

### ì‹¤ìŠµ

#### 2ë²ˆì§¸ë¡œ ì˜¤ë˜ëœ ì»¤ë°‹ì— hello.txt ë¹ˆíŒŒì¼ì„ ì¶”ê°€í•´ì„œ ìˆ˜ì •(amend)í•˜ê³  commit messageë„ "Add knapsack problem PDF and hello.txt" ë¡œ ìˆ˜ì •(amend)í•˜ê¸°

```shell
# 2ë²ˆì§¸ë¡œ ì˜¤ë˜ëœ commit ì— í•´ë‹¹ë˜ëŠ”
# "pick" ê¸€ìë¥¼ "edit" ê¸€ìë¡œ ë°”ê¾¸ê³  ì €ì¥í•˜ì  
# nano í¸ì§‘ê¸° ì €ì¥: ctrl + o 
# nano í¸ì§‘ê¸° ë‚˜ê°€ê¸°: ctrl + x
$ git rebase -i --root

# hello.txt ë¹ˆíŒŒì¼ ìƒì„± ë° commit ì¤€ë¹„
$ touch hello.txt
$ git add hello.txt

# commit message ë¥¼ ìˆ˜ì •í•˜ê¸°
# Add knapsack problem PDF and hello.txt
$ git commit --amend

# ë˜ê°ì€ ë‚´ìš© í’€ê¸°(continue)
$ git rebase --continue

# commit ìˆ˜ì • ê²°ê³¼ í™•ì¸í•˜ê¸°
$ git log --oneline

# 2ë²ˆì§¸ë¡œ ì˜¤ë˜ëœ commit ì— í•´ë‹¹ë˜ëŠ” commit IDë¡œ  
# commit ë‚´ìš© í™•ì¸í•˜ê¸°
$ git show "[commit ID]"
```

<br/>

#### ê°€ì¥ ì˜¤ë˜ëœ ì—­ì‚¬ ë¶€í„° ë‘ë²ˆì§¸ commit ì´í›„ì— ìƒˆë¡œìš´ ì»¤ë°‹ commit 3ê°œ ë„£ê¸°

```shell
$ git rebase -i --root

$ touch hello_1.c
$ git add .
$ git commit -m "test: add hello_1.c"

$ touch hello_2.c
$ git add .
$ git commit -m "test: add hello_2.c"

$ touch hello_3.c
$ git add .
$ git commit -m "test: add hello_3.c"

$ git rebase --continue
```

<br/>

#### ìœ„ ì˜ˆì œì—ì„œ ë„£ì€ (ì¤‘ê°„ì— ë‚€) 3ê°œë¥¼ commitì„ 1ê°œë¡œ í•©ì¹˜ê¸°

```shell
# ì—¬ê¸°ì—ì„œ ì¤‘ìš”í•œ ì ì€, í•©ì¹˜ë ¤ê³  í•˜ëŠ” ë…€ì„ë³´ë‹¤ í•œë‹¨ê³„ ì•ì˜ ë…€ì„ì—ê²Œ editì„ ê±°ëŠ” ê²ƒì´ë‹¤.
# ê·¸ë˜ì•¼ ëª¨ë‘ interactive rebaseì— ëœ¨ê²Œ ë˜ëŠ” ê²ƒì„.
$ git rebase -i --root

$ git reset --soft HEAD~1
$ git status

$ git commit --amend
$ git rebase --continue
```

- `reset -- soft HEAD~1` ì´ë€?
  - reset --hard, --soft ì°¨ì´
  - hard : ì»¤ë°‹ íˆìŠ¤í† ë¦¬ ë¶„ì˜ íŒŒì¼ ì „ë¶€ ì‚­ì œ.
  - soft : ì»¤ë°‹ì€ ì§€ì›Œì§€ì§€ë§Œ, íŒŒì¼ì€ ë‚¨ì•„ìˆê²Œ ëœë‹¤. ì»¤ë°‹í•  ì¤€ë¹„ê°€ ë˜ì–´ìˆëŠ” ê²ƒì„(ì¦‰, addë¡œ ë˜ì–´ ìˆëŠ” ê²ƒì´ë‹¤.)
- ì¦‰, ì—¬ê¸°ì„œëŠ” ì»¤ë°‹ì„ reset ëª…ë ¹ì–´ë¡œ ì§€ìš°ëŠ”ë°, í•´ë‹¹ commitì˜ ë³€ê²½ë¶„ì€ localì— ë‚¨ì•„ìˆê²Œ ë˜ê³ ,
- commit --amend ëª…ë ¹ì–´ë¥¼ í†µí•´ ì§€ê¸ˆ ìœ„ì¹˜í•œ commitì— ë³€ê²½ë¶„ì„ í•©ì¹˜ëŠ” ì‘ì—…ì„ í•œ ê²ƒì„.

<br/>

#### ê°€ì¥ ì˜¤ë˜ëœ ì—­ì‚¬ì—ì„œ ë‘ë²ˆì§¸ ì»¤ë°‹ "Add knapsack problem PDF" ì‚­ì œí•˜ê¸°

```shell
$ git rebase -i --root
$ git reset --hard HEAD~1
$ git rebase --continue
```

<br/>

rebase ì‹œ, ì˜ëª» í•©ì³¤ì„ ë•Œ `rollback` í•˜ë ¤ë©´,

```shell
$ git reset --hard origin/master
```

ì´ëŸ¬ë©´ ì™„ì „ ì›ë³µì„. clone ë°›ì•˜ì„ ë•Œë¡œ ëŒì•„ê°€ê²Œ ëœë‹¤.
