# Layout Shift

> [web.dev](https://web.dev/articles/cls?hl=ko), [최적화 방법](https://web.dev/articles/optimize-cls?hl=ko)

일반적으로 리소스가 비동기식으로 로드되거나 DOM 요소가 기본 콘텐츠 위의 페이지에 동적으로 추가되기 때문에 페이지 콘텐츠의 예기치 않은 이동이 발생한다. 크기를 알 수 없는 이미지 또는 동영상, 대체 글꼴보다 크거나 작게 렌더링 되는 글꼴, 동적으로 크기가 조절되는 서드 파티 광고 또는 위젯이 원인일 수 있다.

큰 문제는 개발 중인 사이트의 작동 방식과 사용자가 경험하는 방식과 차이가 있기 때문임. 개인 맞춤 콘텐츠 또는 서드 파티 콘텐츠는 개발 단계에서 프로덕션 환경과 동일한 방식으로 작동하지 않는 경우가 많고, 테스트 이미지가 이미 개발자의 브라우저 캐시에 있는 경우가 많으며, 로컬에서 실행되는 API 호출은 매우 빨라져 지연이 눈에 띄지 않는 경우가 많음.

레이아웃 변경 횟수(CLS) 측정 항목은 실제 사용자에게 발생하는 빈도를 측정, 이 문제를 해결하는데 도움이 된다.

<br/>

## CLS란?

페이지의 전체 수명 동안 발생하는 모든 예상치 못한 레이아웃 변경에 관한 레이아웃 변경 점수의 최대 버스트를 측정한 것이다.

레이아웃 변경은 표시되는 요소가 하나의 렌더링된 프레임에서 다음 프레임으로 위치를 변경할 때마다 발생한다. 하나 이상의 개별 레이아웃 변경이 각 이동 간격이 1초 미만이고 총 윈도우 지속 시간이 최대 5초인 경우 빠르게 연속으로 발생하는 경우를 말한다.

<br/>

## 레이아웃 변경 세부정보

레이아웃 변경은 기존 요소가 시작 위치를 변경할 때만 발생한다. 새 요소가 DOM에 추가되거나 기존 요소의 크기가 변경되면 다른 시각적 요소의 시작 위치가 변경되지 않는 한 레이아웃 변경으로 간주되지 않는다.

<br/>

## 최적화

CLS가 저조한 원인은 다음과 같다.

- 크기가 없는 이미지
- 측정 기준이 없는 광고, 삽입, iframe
- 크기가 없는 광고, 삽입, iframe과 같이 동적으로 삽입된 콘텐츠
- 웹 글꼴

### 크기가 없는 이미지

너비와 높이가 지정된 이미지를 사용해라. 이미지의 width, height 속성을 주면 된다.

```html
<img src="puppy.jpg" width="640" height="360" alt="Puppy with balloons">
```

이렇게 하면 리플로우와 레이아웃 재배치가 최소화 된다. 반응형 웹 디자인이 도입 되었을 때 개발자는 width, height 를 생략하고 CSS를 이용해 이미지 크기를 조절했다.

```css
img {
  width: 100%; /* or max-width: 100%; */
  height: auto;
}
```

이 방식의 단점은, 이미지 다운로드가 시작되고 브라우저가 이미지 크기를 결정할 수 있게 된 후에만 이미지에 공간을 할당할 수 있다는 점이다. 이미지가 로드될 때 각 이미지가 화면에 표시될 때 페이지가 리플로우 된다. 화면에 텍스트가 갑자기 튀어 나오는 경우가 일반적이 되었다.

가로 세로 비율이 중요하다. 이미지의 가로세로 비율은 이미지 너비와 높이의 비율이다. 일반적으로 콜론으로 구분된 두 개의 숫자(16:9 또는 4:3) 으로 표시된ㄴ다. x:y가로 세로 비율의 경우 이미지는 너비가 x단위, 높이가 y단위다.

가로 세로 비율을 알면 브라우저에서 높이와 관련 영역을 위한 충분한 공간을 계산하고 확보할 수 있다.

#### 이미지 크기 설정을 위한 최신 권장사항

최신 브라우저에서는 width, height 를 기준으로 가로 세로 비율을 설정하므로 레이아웃 변경을 방지하기 위해 속성을 설정하고 위의 CSS를 포함하면 된다.

```html
<!-- set a 640:360 i.e a 16:9 aspect ratio -->
<img src="puppy.jpg" width="640" height="360" alt="Puppy with balloons">
```









































