# 실행 컨텍스트

실행 컨텍스트는 실행할 코드에 제공할 환경정보들을 모아놓은 객체. 자바스크립트는 어떤 실행 컨텍스트가 활성화되는 시점에 선언된 변수를 위로 끌어올리고(호이스팅), 외부 환경 정보를 구성하고, this 값을 설정하는 등의 동작을 수행.

<br/>

동일한 환경에 있는 코드들을 실행할 때, 필요한 환경 정보를 모아 컨텍스트를 구성하고 이를 '**콜스택**(call stack)'에 쌓아 관련있는 코드를 하나하나 실행함. 여기서 동일한 환경 즉, 하나의 실행 컨텍스트를 구성할 수 있는 방법으로 `전역공간`, `eval함수`, `함수` 등이 있다.
자동으로 생성되는 전역공간과 악마로 취급받는 eval을 제외하면 우리가 흔히 실행 컨텍스트를 구성하는 방법은 '함수'를 실행하는 것 뿐.

```js
var a = 1;

function outer() {
  function inner() {
    console.log(a); // undefined
    var a = 3;
  }
  inner();
  console.log(a); // 1
}

outer();
console.log(a); // 1
```

<br/>

1. 처음 JS가 시작하는 순간 전역 컨텍스트가 콜스택에 담김. 최상단 공간은 코드 내부에서 별도의 실행 명령 없이도 브라우저에서 자동으로 실행하므로 JS 파일이 열리는 순간 **전역 컨텍스트**가 활성화 된다고 이해하면 된다.
2. 전역 컨텍스트와 관련된 코드를 실행하다가, outer 함수의 호출. outer에 대한 환경 정보를 수집해서 outer 실행 컨텍스트를 생성 후 콜 스택에 담는다. outer 실행 컨텍스트가 콜스택 맨 위이므로 전역 컨텍스트 실행을 일시 중단, outer의 실행 컨텍스트와 관련된 코드를 실행함.
3. inner 함수의 실행. 
	- inner 함수 내부 a에 3을 할당, inner 종료 후 inner 실행 컨텍스트 종료, 콜스택에서도 제거됨.
4. outer 컨텍스트가 콜 스택 맨 위이므로 이어서 실행.
	- 변수 a 의 값을 출력 후 outer 실행 컨텍스트 종료. 콜스택에서도 제거 됨.
5. 마지막 전역의 a 변수 값 출력. 전역 공간에 아무것도 남지 않은 상태로 종료된다. 전역 컨텍스트도 종료

<br/>

스택 구조를 잘 보면, 한 실행 컨텍스트가 콜 스택의 맨 위에 쌓이는 순간이 곧 현재 실행할 코드에 관여하게 되는 시점. 어떤 실행 컨텍스트가 활성화될 때 자바스크립트 엔진은 해당 컨텍스트에 관련된 코드들을 실행하는데 필요한 환경 정보들을 수집해서 실행 컨텍스트 객체에 저장한다.

<br/>

- **VariableEnvironment**: 현재 컨텍스트 내의,
	- 식별자들에 대한 정보 + 외부 환경 정보
	- 선언 시점의 LexicalEnvironment의 스냅샷
- **LexicalEnvironment**: 처음의 VariableEnvironment와 같지만 변경 사항이 실시간으로 반영됨.
- **ThisBinding**: this 식별자가 바라봐야할 대상 객체.

<br/>
<br/>

## VariableEnvironment
실행 컨텍스트를 생성할 때 VariableEnvironment 정보를 먼저 담고, 이를 복사해 LexicalEnvironment를 만들고, 이후에는 LexicalEnvironment를 주로 이용하게 된다.
VariableEnvironment, LexicalEnvironment의 내부는 environmentRecord와 outer-environmentReference로 구성되어 있다. 

<br/>

## LexicalEnvironment
'어휘적 환경', '정적 환경'이라고 불리지만, 별로고, 필자는 '사전적인'이라는 단어가 더 어울리는 것 같다고 함. '현재 실행 컨텍스트 내부에는 a, b, c 와 같은 식별자가 있고 그 외부 정보는 D를 참조하도록 구성되어 있다' 와 비슷한 느낌.







