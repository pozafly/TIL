# 방화벽

- 서버 사이트를 인터넷으로 보호
- 기능
	- 애플리케이션 식별
	- IPS(Intrusion Prevention System, 침입방지시스템) / IDS(Intrusion Detection System, 침입탐지시스템)
	- 바이러스 탐지 기능
	- VPN(Virtual Private Network)

## UDP 방화벽

- 방화벽의 통신제어 기술을 '**스테이트풀 인스펙션**'이라고 함.
	- 통신의 허용/거부를 정의하는 '방화벽 규칙'으로 구성된 '**필터 테이블**'
	- 통신을 관리하는 '**커넥션 테이블**'을 통해 흐르는 통신을 제어함.

### 흐름

1. 방화벽은 커넥션이 없는 UDP를 커넥션형 프로토콜처럼 취급, UDP 통신을 제어함.
	- 방화벽은 UDP 요청 패킷을 받으면 커넥션 테이블을 보고 커넥션 항목을 확인
	- 처음엔 없으므로 NAT 및 라우팅 처리 수행, 필터 테이블과 대조해 새로운 커넥션 생성
![[Pasted image 20260120154929.png]]
2. 필터 테이블에서 허용(ACCEPT)인 방화벽 규칙을 만족하는 경우 커넥션 테이블에 수신한 요청 패킷의 정보와 앞으로 수신할 예정인 응답 패킷의 정보를 커넥션 항목으로 추가, lb1에 요청 패킷을 전달함.
![[Pasted image 20260120155029.png]]
한편, 거부(REJECT) 방화벽 규칙에 걸린 경우 커넥션 테이블에 항목 추가하지 않고 ns1에 대해 유형이 'Destination Unreachable(타입3)', 코드가 'Port Unreachable(코드3)'인 ICMP 패킷을 반환함.
![[Pasted image 20260120155137.png]]
드롭(DROP)에 걸리면 커넥션 테이블에 항목을 추가하지 않고 아무 조치도 취하지 않음. 위의 **거부** 액션은 어떤 장비가 존재한다는 것을 나타내게 되므로 보안 측면에서 좋지 않음. 그런 점에서 드롭 동작은 단순히 UDP 데이터그램을 파기하는 것 뿐, 상대방이 모르기 때문에 'Silent Discard'라고도 불림.
![[Pasted image 20260120155304.png]]

3. 액션이 허용(ACCEPT) 통과하면 DNS나 NTP와 같이 서버로부터 응답이 발생하는 경우가 있음.
   lb1의 응답 패킷은 NAT 후 요청 패킷의 발신자 IP 주소, 목적지 IP 주소, 포트 번호가 바뀌어 있는 것임. 커넥션 항목의 유휴 타임아웃 값(커넥션을 삭제할 때까지의 시간)을 재설정함. 확립된 커넥션으로 간주, 해당 정보를 바탕으로 NAT 및 라우팅 처리를 수행하고 필터 테이블과 대조. 설정된 커넥션은 허용이므로 ns1으로 전달한다.
![[Pasted image 20260120155456.png]]
4. 통신이 끝나면 유휴 시간 제한 값을 카운트다운 함. 0이 되면 커넥션 항목 삭제. iptables의 UDP 유휴 시간 제한은 기본적으로 30초.
