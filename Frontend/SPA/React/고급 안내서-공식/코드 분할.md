# ì½”ë“œ ë¶„í• 

## ë²ˆë“¤ë§

ëŒ€ë¶€ë¶„ React ì•±ë“¤ì€ `Webpack`, `Rollup`, ë˜ëŠ” `Browserify` ê°™ì€ íˆ´ì„ ì‚¬ìš©í•´ ì—¬ëŸ¬ íŒŒì¼ì„ í•˜ë‚˜ë¡œ ë³‘í•©í•œ 'ë²ˆë“¤ ëœ' íŒŒì¼ë“¤ì„ ì›¹ í˜ì´ì§€ì— í¬í•¨í•´ í•œ ë²ˆì— ì „ì²´ ì•±ì„ ë¡œë“œí•  ìˆ˜ ìˆë‹¤.

### ì˜ˆì‹œ

- App

```js
// app.js
import { add } from './math.js';

console.log(add(16, 26));  // 42
```

```js
// math.js
export function add(a, b) {
  return a + b;
}
```

- Bundle

```js
function add(a, b) {
  return a + b;
}
console.log(add(16, 26));  // 42
```

ì‹¤ì œ ë²ˆë“¤ì€ ìœ„ ì½”ë“œì™€ ë§ì´ ë‹¤ë¦„.

Create React App ì´ë‚˜, Next.js, Gatsby í˜¹ì€ ë¹„ìŠ·í•œ íˆ´ì„ ì‚¬ìš©í•˜ë©´ ì„¤ì¹˜í•œ ì•±ì—ì„œ Webpackì´ ê°™ì´ ì„¤ì¹˜ë  ê²ƒì„.

<br/>

## ì½”ë“œ ë¶„í• 

ë²ˆë“¤ë§ì€ í›Œë¥­í•˜ì§€ë§Œ ì•±ì´ ì»¤ì§€ë©´ ë²ˆë“¤ë„ ì»¤ì§. íŠ¹íˆ í° ê·œëª¨ì˜ ì„œë“œ íŒŒí‹° ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì¶”ê°€í•  ë•Œ ì‹¤ìˆ˜ë¡œ ì•±ì´ ì»¤ì ¸ ë¡œë“œ ì‹œê°„ì´ ê¸¸ì–´ì§€ëŠ” ê²ƒì„ ë°©ì§€í•˜ê¸° ìœ„í•´ ì½”ë“œë¥¼ ì£¼ì˜ ê¹Šê²Œ ì‚´í´ì•¼ í•¨.

ë²ˆë“¤ì´ ê±°ëŒ€í•´ì§€ëŠ” ê²ƒì„ ë°©ì§€í•˜ê¸° ìœ„í•œ ì¢‹ì€ í•´ê²°ë²•ì€ ë²ˆë“¤ì„ 'ë‚˜ëˆ„ëŠ”' ê²ƒì„. **ì½”ë“œ ë¶„í• **ì€ ëŸ°íƒ€ì„ì— ì—¬ëŸ¬ ë²ˆë“¤ì„ ë™ì ìœ¼ë¡œ ë§Œë“¤ê³  ë¶ˆëŸ¬ì˜¤ëŠ” ê²ƒìœ¼ë¡œ, `Webpack`, `Rollup`, ë˜ëŠ” `Browserify` ê°™ì€ ë²ˆë“¤ëŸ¬ê°€ ì§€ì›í•˜ëŠ” ê²ƒì´ë‹¤.

ì½”ë“œ ë¶„í• ì€ ì•±ì„ `ì§€ì—° ë¡œë”©` í•˜ê²Œ ë„ì™€ì£¼ê³ , ì•± ì‚¬ìš©ìì—ê²Œ íšê¸°ì ì¸ ì„±ëŠ¥ í–¥ìƒì„ í•˜ê²Œ í•¨. ì•±ì˜ ì½”ë“œ ì–‘ì„ ì¤„ì´ì§€ ì•Šê³ ë„ ì‚¬ìš©ìê°€ í•„ìš”í•˜ì§€ ì•Šì€ ì½”ë“œë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ì•Šê²Œ í•˜ë©° ì•±ì˜ ì´ˆê¸°í™” ë¡œë”©ì— í•„ìš”í•œ ë¹„ìš©ì„ ì¤„ì—¬ì¤Œ.

<br/>

## import()

ì•±ì— ì½”ë“œ ë¶„í• ì„ ë„ì…í•˜ëŠ” ê°€ì¥ ì¢‹ì€ ë°©ë²•ì€ ë™ì  `import()` ë¬¸ë²•ì„ ì‚¬ìš©í•˜ëŠ” ë°©ë²•ì„.

### Before

```js
import { add } from './math.js';

console.log(add(16, 26));  // 42
```

### After

```js
import("./math").then(math => {
  console.log(math.add(16, 26));
});
```

Webpackì´ ì´ êµ¬ë¬¸ì„ ë§Œë‚˜ê²Œ ë˜ë©´ ì•±ì˜ ì½”ë“œë¥¼ ë¶„í• í•œë‹¤. CRAë¥¼ ì‚¬ìš©í•œë‹¤ë©´ ì´ë¯¸ Webpackì˜ êµ¬ì„±ì´ ë˜ì–´ìˆê¸° ë•Œë¬¸ì— [ì‚¬ìš©](https://create-react-app.dev/docs/code-splitting/)í•  ìˆ˜ ìˆìŒ. [Next.js](https://nextjs.org/docs/advanced-features/dynamic-import) ì—­ì‹œ ì§€ì›í•¨.

[ì½”ë“œ ë¶„í•  ê°€ì´ë“œ](https://webpack.js.org/guides/code-splitting/)ë¥¼ ì°¸ì¡°. Webpack ì„¤ì •ì€ [ê°€ì´ë“œ](https://gist.github.com/gaearon/ca6e803f5c604d37468b0091d9959269)ì— ìˆë‹¤.

[Babel](http://babeljs.io/)ì„ ì‚¬ìš©í•  ë•ŒëŠ” Babelì´ ë™ì  importë¥¼ ì¸ì‹í•  ìˆ˜ ìˆì§€ë§Œ ë³€í™˜í•˜ì§€ëŠ” ì•Šë„ë¡ í•œë‹¤. ì´ë¥¼ ìœ„í•´ [babel-plugin-syntax-dynamic-import](https://yarnpkg.com/en/package/babel-plugin-syntax-dynamic-import)ë¥¼ ì‚¬ìš©í•´ì•¼í•¨.

<br/>

## React.lazy

---

ğŸ“Œ ì£¼ì˜ì  (ì‘ì„±ì‹œì : 2021/3/24)

`React.lazy` ì™€ SuspensëŠ” ì•„ì§ SSRì„ ì‚¬ìš©í•  ìˆ˜ ì—†ìŒ. SSRëœ ì•±ì—ì„œ ì½”ë“œ ë¶„í• ì„ í•˜ê¸° ì›í•˜ë©´, [Loadable Components](https://github.com/gregberge/loadable-components)ë¥¼ ì¶”ì²œ. ì´ëŠ” [ì„œë²„ ì‚¬ì´ë“œ ë Œë”ë§ê³¼ ë²ˆë“¤ ìŠ¤í”Œë¦¬íŒ…ì— ëŒ€í•œ ì¢‹ì€ ê°€ì´ë“œ](https://loadable-components.com/docs/server-side-rendering/)ì„.

---

`React.lazy` í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•˜ë©´ ë™ì  importë¥¼ ì‚¬ìš©í•´ ì»´í¬ë„ŒíŠ¸ë¥¼ ë Œë”ë§í•  ìˆ˜ ìˆìŒ.

### Before

```js
import OtherComponent from './OtherComponent';
```

### After

```js
const OtherComponent = React.lazy(() => import('./OtherComponent'));
```

componentê°€ ì²˜ìŒ ë Œë”ë§ ë  ë•Œ, `OtherComponent` ë¥¼ í¬í•¨í•œ ë²ˆë“¤ì„ ìë™ìœ¼ë¡œ ë¶ˆëŸ¬ì˜¨ë‹¤.

`React.lazy` ëŠ” ë™ì  `import()` ë¥¼ í˜¸ì¶œí•˜ëŠ” í•¨ìˆ˜ë¥¼ ì¸ìë¡œ ê°€ì§„ë‹¤. ì´ í•¨ìˆ˜ëŠ” React ì»´í¬ë„ŒíŠ¸ë¥¼ í¬í•¨í•˜ì—¬ `default` export ë¥¼ ê°€ì§„ ëª¨ë“ˆë¡œ ê²°ì •ë˜ëŠ” `Promise` ë¡œ ë°˜í™˜ í•´ì•¼í•œë‹¤.

lazy ì»´í¬ë„ŒíŠ¸ëŠ” `Suspense` ì»´í¬ë„ŒíŠ¸ í•˜ìœ„ì—ì„œ ë Œë”ë§ ë˜ì–´ì•¼ í•˜ë©°, `Suspense` ëŠ” lazy ì»´í¬ë„ŒíŠ¸ê°€ ë¡œë“œ ë˜ê¸¸ ê¸°ë‹¤ë¦¬ëŠ” ë™ì•ˆ ë¡œë”© í™”ë©´ê³¼ ê°™ì€ ì˜ˆë¹„ ì»¨í…ì¸ ë¥¼ ë³´ì—¬ì¤„ ìˆ˜ ìˆê²Œ í•´ì¤€ë‹¤.

```jsx
import React, { Suspense } from 'react';

const OtherComponent = React.lazy(() => import('./OtherComponent'));

function MyComponent() {
  return (
    <div>
      <Suspense fallback={<div>Loading...</div>}>  // ğŸš€
        <OtherComponent />
      </Suspense>
    </div>
  );
}
```

- ğŸš€: `fallback` propì€ ì»´í¬ë„ŒíŠ¸ê°€ ë¡œë“œë  ë•Œê¹Œì§€ ê¸°ë‹¤ë¦¬ëŠ” ë™ì•ˆ ë Œë”ë§ í•˜ë ¤ëŠ” React ì—˜ë¦¬ë¨¼íŠ¸ë¥¼ ë°›ì•„ë“¤ì¸ë‹¤. `Suspense` ì»´í¬ë„ŒíŠ¸ëŠ” lazy ì»´í¬ë„ŒíŠ¸ë¥¼ ê°ì‹¼ë‹¤.

í•˜ë‚˜ì˜ Suspense ì»´í¬ë„ŒíŠ¸ë¡œ ì—¬ëŸ¬ lazy ì»´í¬ë„ŒíŠ¸ë¥¼ ê°ìŒ€ ìˆ˜ ìˆë‹¤.

```jsx
import React, { Suspense } from 'react';

const OtherComponent = React.lazy(() => import('./OtherComponent'));
const AnotherComponent = React.lazy(() => import('./AnotherComponent'));

function MyComponent() {
  return (
    <div>
      <Suspense fallback={<div>Loading...</div>}>
        <section>
          <OtherComponent />
          <AnotherComponent />
        </section>
      </Suspense>
    </div>
  );
}
```

### Error boundaries - í´ë˜ìŠ¤í˜• ì»´í¬ë„ŒíŠ¸ì—ì„œë§Œ ê°€ëŠ¥(í˜„ì¬ 17.0.1 ë²„ì „)

ë„¤íŠ¸ì›Œí¬ ì¥ì•  ê°™ì€ ì´ìœ ë¡œ ë‹¤ë¥¸ ëª¨ë“ˆì„ ë¡œë“œì— ì‹¤íŒ¨í•  ê²½ìš° ì—ëŸ¬ë¥¼ ë°œìƒì‹œí‚¬ ìˆ˜ ìˆë‹¤. ì´ë•Œ, [Error Boundaries](https://ko.reactjs.org/docs/error-boundaries.html) ë¥¼ ì´ìš©í•˜ì—¬ ì‚¬ìš©ìì˜ ê²½í—˜ê³¼ ë³µêµ¬ ê´€ë¦¬ë¥¼ ì²˜ë¦¬í•  ìˆ˜ ìˆë‹¤. Error Boundaryë¥¼ ë§Œë“¤ê³  lazy ì»´í¬ë„ŒíŠ¸ë¥¼ ê°ì‹¸ë©´ ë„¤íŠ¸ì›Œí¬ ì¥ì• ê°€ ë°œìƒí–ˆì„ ë•Œ ì—ëŸ¬ë¥¼ í‘œì‹œí•  ìˆ˜ ìˆë‹¤.

```jsx
import React, { Suspense } from 'react';
import MyErrorBoundary from './MyErrorBoundary';

const OtherComponent = React.lazy(() => import('./OtherComponent'));
const AnotherComponent = React.lazy(() => import('./AnotherComponent'));

const MyComponent = () => (
  <div>
    <MyErrorBoundary>
      <Suspense fallback={<div>Loading...</div>}>
        <section>
          <OtherComponent />
          <AnotherComponent />
        </section>
      </Suspense>
    </MyErrorBoundary>
  </div>
);
```

---

<br/>

## Route-based code splitting

ì•±ì— ì½”ë“œ ë¶„í• ì„ ì–´ëŠê³³ì— ë„ì…í• ì§€ ê²°ì •í•˜ëŠ” ê²ƒì€ ê¹Œë‹¤ë¡œì›€. ì‚¬ìš©ìì˜ ê²½í—˜ì„ í—¤ì¹˜ì§€ ì•Šìœ¼ë©´ì„œ ë²ˆë“¤ì„ ê· ë“±í•˜ê²Œ ë¶„ë°°í•  ê³³ì„ ì°¾ì•„ì•¼ í•¨.

ì´ë¥¼ ì‹œì‘í•˜ê¸° ì¢‹ì€ ì¥ì†ŒëŠ” ë¼ìš°íŠ¸ì„. ì›¹ í˜ì´ì§€ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì‹œê°„ì€ í˜ì´ì§€ ì „í™˜ì— ì–´ëŠ ì •ë„ ë°œìƒí•˜ë©° ëŒ€ë¶€ë¶„ í˜ì´ì§€ë¥¼ í•œë²ˆì— ë Œë”ë§í•˜ê¸° ë•Œë¬¸ì— ì‚¬ìš©ìê°€ í˜ì´ì§€ë¥¼ ë Œë”ë§ í•˜ëŠ” ë™ì•ˆ ë‹¤ë¥¸ ìš”ì†Œì™€ ìƒí˜¸ì‘ìš©í•˜ì§€ ì•ŠëŠ”ë‹¤.

React.lazyë¥¼ `React Router` ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•´ ì–´í”Œë¦¬ì¼€ì´ì…˜ì— ë¼ìš°íŠ¸ ê¸°ë°˜ ì½”ë“œ ë¶„í• ì„ ì„¤ì •í•˜ëŠ” ì˜ˆì‹œì„.

```jsx
import React, { Suspense, lazy } from 'react';
import { BrowserRouter as Router, Route, Switch } from 'react-router-dom';

const Home = lazy(() => import('./routes/Home'));
const About = lazy(() => import('./routes/About'));

const App = () => (
  <Router>
    <Suspense fallback={<div>Loading...</div>}>
      <Switch>
        <Route exact path="/" component={Home}/>
        <Route path="/about" component={About}/>
      </Switch>
    </Suspense>
  </Router>
);
```

<br/>

## Named Exports

React.lazyëŠ” í˜„ì¬ default exports ë§Œ ì§€ì›í•œë‹¤. named exportsë¥¼ ì‚¬ìš©í•˜ê³ ì í•œë‹¤ë©´ defaultë¡œ ì´ë¦„ì„ ì¬ì •ì˜í•œ ì¤‘ê°„ ëª¨ë“ˆì„ ìƒì„±í•  ìˆ˜ ìˆë‹¤. ì´ë ‡ê²Œ í•˜ë©´ tree shakingì´ ê³„ì† ë™ì‘í•˜ê³  ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” ì»´í¬ë„ŒíŠ¸ëŠ” ê°€ì ¸ì˜¤ì§€ ì•ŠëŠ”ë‹¤.

```js
// ManyComponents.js
export const MyComponent = /* ... */;
export const MyUnusedComponent = /* ... */;
```

```js
// MyComponent.js
export { MyComponent as default } from "./ManyComponents.js";
```

```js
// MyApp.js
import React, { lazy } from 'react';
const MyComponent = lazy(() => import("./MyComponent.js"));
```

<br/>

## ì‹¤ìŠµ

> ì¶œì²˜: https://velog.io/@ansrjsdn/React.lazy-%EC%82%AC%EC%9A%A9%ED%95%B4%EB%B3%B4%EA%B8%B0

srcí´ë” ë°‘ì— components í´ë”ë¥¼ ë§Œë“¤ê³  ê·¸ ì•ˆì— ë‹¤ìŒê³¼ ê°™ì€ íŒŒì¼ë“¤ì„ ë§Œë“¤ì—ˆìŒ.

- LazyWrapper.jsx: Item ë“¤ì„ ê·¸ë¦´ ì»´í¬ë„ŒíŠ¸.
- LazyItem.jsx: ê°ê°ì˜ Item ì»´í¬ë„ŒíŠ¸.
- LazyImage.jsx: Item ì•ˆì˜ ì´ë¯¸ì§€ë¥¼ ê·¸ë¦´ ì»´í¬ë„ŒíŠ¸.

database í´ë”ë¥¼ ë§Œë“¤ê³  images.js íŒŒì¼ì„ ë§Œë“¤ì—ˆë‹¤.

```js
// database/images.js
export const images = [
  {
    id: 0,
    src:
      'https://images.unsplash.com/photo-1558979158-65a1eaa08691?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&auto=format&fit=crop&w=1050&q=80',
    name: 'landscape',
  },
  {
    id: 1,
    src:
      'https://images.unsplash.com/photo-1585858966753-e25673d9c46c?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&auto=format&fit=crop&w=1051&q=80',
    name: 'snack',
  },
  {
    id: 3,
    src:
      'https://images.unsplash.com/photo-1527304240506-c090883340d9?ixlib=rb-1.2.1&auto=format&fit=crop&w=1050&q=80',
    name: 'children',
  },
  {
    id: 4,
    src:
      'https://images.unsplash.com/photo-1499323888381-7fd102a793de?ixlib=rb-1.2.1&auto=format&fit=crop&w=967&q=80',
    name: 'girl',
  },
  {
    id: 5,
    src:
      'https://images.unsplash.com/photo-1485744455408-5363f9f7e1d3?ixlib=rb-1.2.1&auto=format&fit=crop&w=900&q=60',
    name: 'butterfly',
  },
  {
    id: 6,
    src:
      'https://images.unsplash.com/photo-1529429649738-cf96fc78378b?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&auto=format&fit=crop&w=1055&q=80',
    name: 'man & sea',
  },
  {
    id: 7,
    src:
      'https://images.unsplash.com/photo-1442528010304-834a5d4f3925?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&auto=format&fit=crop&w=900&q=60',
    name: 'sun flower',
  },
  {
    id: 8,
    src:
      'https://images.unsplash.com/photo-1438109491414-7198515b166b?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&auto=format&fit=crop&w=1050&q=80',
    name: 'camera girl',
  },
  {
    id: 9,
    src:
      'https://images.unsplash.com/photo-1474312650852-739d4703e766?ixlib=rb-1.2.1&auto=format&fit=crop&w=1050&q=80',
    name: 'camera man',
  },
  {
    id: 10,
    src:
      'https://images.unsplash.com/photo-1586041828037-18790fa5bedd?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&auto=format&fit=crop&w=900&q=60',
    name: 'cake',
  },
  {
    id: 11,
    src:
      'https://images.unsplash.com/photo-1586053146627-018fff4b0e84?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&auto=format&fit=crop&w=701&q=80',
    name: 'car',
  },
];
```

ì´ì œ ì»´í¬ë„ŒíŠ¸ë¥¼ ê·¸ë ¤ë³´ì.

- App.js

```jsx
import React from 'react';
import LazyWrapper from './components/LazyWrapper';

const App = () => {
  return (
    <div>
      <LazyWrapper />
    </div>
  );
};

export default App;
```

- LazyWrapper.jsx

```jsx
import React from 'react';
import { images } from '../database/images';
import LazyItem from './LazyItem';

const LazyWrapper = () => {
  return (
    <div>
      {images.map((image) => (
        <LazyItem key={image.id} src={image.src} name={image.name} />
      ))}
    </div>
  );
};

export default LazyWrapper;
```

- LazyItem.jsx

```jsx
import React, { lazy, Suspense } from 'react';
// ì´ë¯¸ì§€ë¥¼ ê·¸ë¦¬ëŠ” ì»´í¬ë„ŒíŠ¸ë¥¼ lazy ì‹œì¼°ìŒ. 
// lazyëŠ” ë™ì  importë¥¼ ì‚¬ìš©í•˜ëŠ” í•¨ìˆ˜ë¥¼ ì¸ìë¡œ ë„£ì–´ì¤˜ì•¼í•¨.
const LazyImage = lazy(() => import('./LazyImage'));

const LazyItem = ({ src, name }) => {
  return (
    <div>
      <Suspense fallback={<div>...loading</div>}>  // ğŸŒˆ
        <LazyImage src={src} name={name} />  // ğŸ‘»
      </Suspense>
      {name}
    </div>
  );
};

export default LazyItem;
```

- ğŸŒˆ: ì»´í¬ë„ŒíŠ¸ê°€ ë‹¤ ë¶ˆëŸ¬ì˜¤ê¸° ì „ê¹Œì§€ â€¦loadingì´ë¼ëŠ” ì»´í¬ë„ŒíŠ¸ë¥¼ ë³´ì—¬ì¤Œ. Suspenseë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šìœ¼ë©´ ì—ëŸ¬ê°€ ë‚¨.
- ğŸ‘»: ë‹¤ ë¶ˆëŸ¬ì™€ì§€ë©´ í•´ë‹¹ ì»´í¬ë„ŒíŠ¸ë¥¼ ë³´ì—¬ì¤Œ.
- LazyImage.jsx

```jsx
import React from 'react';

const LazyImage = ({ src, name }) => {
  return (
    <div>
      <img src={src} alt={name} />
    </div>
  );
};

export default LazyImage;
```

ê°œë°œìë„êµ¬ì˜ ë„¤íŠ¸ì›Œí¬ ì°½ìœ¼ë¡œ ê°€ì„œ onlineìœ¼ë¡œ ì„¤ì •ë˜ì–´ìˆëŠ”ê±¸ Fast 3Gë¡œ ë°”ê¾¸ë©´ ì´ë¯¸ì§€ ë¶€ë¶„ì´ â€¦loadingì´ ë–³ë‹¤ê°€ ì‚¬ì§„ì´ ë‚˜ì˜¤ëŠ”ê±¸ ë³¼ ìˆ˜ê°€ ìˆìŒ.
