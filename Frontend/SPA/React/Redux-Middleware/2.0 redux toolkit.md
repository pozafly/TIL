# Redux toolkit

> ì¶œì²˜
>
> [Redux Toolkitì„ í™œìš©í•œ React ìƒíƒœ ê´€ë¦¬](https://blog.rhostem.com/posts/2020-03-04-redux-toolkits), [redux toolkit ì‚¬ìš©í•˜ê¸°](https://velog.io/@hojin9622/redux-toolkit-%EC%82%AC%EC%9A%A9%ED%95%98%EA%B8%B0), [redux-toolkitì„ ì†Œê°œí•©ë‹ˆë‹¤.](https://jbee.io/react/introduce-redux-starter-kit/)

<br/>

Redux toolkitì€ ë§ì€ ì–‘ì˜ redux ì½”ë“œë¥¼ ë” ì ì€ ì–‘ì˜ ì½”ë“œë¡œ ì“°ê²Œ ë„ì™€ì£¼ëŠ” ê²ƒ.

## ì™¸ë¶€ ë¼ì´ë¸ŒëŸ¬ë¦¬ì˜ ë„ì…

Redux Toolkitì—ì„œëŠ” ì´ë¦„ ìˆëŠ” Redux ê´€ë ¨ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ë‚´ë¶€ì ìœ¼ë¡œ ë„ì…í•´ì„œ ì‚¬ìš©í•˜ê³  ìˆë‹¤. ë¦¬ë“€ì„œ ìƒì„± APIì—ëŠ” immerë¥¼, ì…€ë ‰í„° ìƒì„± APIì—ëŠ” reselectë¥¼ ì‚¬ìš©í•¨. redux-actions, redux-thunkë¥¼ defaultë¡œ ì§€ì›í•¨.

<br/>

## ì„¤ì¹˜

```sh
$ yarn add @reduxjs/toolkit
```

<br/>

## createAction

```jsx
// ì•¡ì…˜ íƒ€ì…
const ADD = "ADD";
const DELETE = "DELETE";

// ì•¡ì…˜ ìƒì„±ì í•¨ìˆ˜
const addToDo = (text) => {
  return {
    type: ADD,
    text,
  };
};

const deleteToDo = (id) => {
  return {
    type: DELETE,
    id: parseInt(id),
  };
};
```

ì´ ì½”ë“œë¥¼,

```jsx
import { createAction } from '@reduxjs/toolkit'

// ì•¡ì…˜ íƒ€ì…ê³¼, ì•¡ì…˜ ìƒì„±ì í•¨ìˆ˜ë¥¼ ë™ì‹œì— ë§Œë“¦
const addToDo = createAction('ADD')
const deleteToDo = createAction('DELETE')
```

ì´ë ‡ê²Œ ê³ ì³¤ë‹¤. createActionì„ ì‚¬ìš©í•´ ë” ì§§ê²Œ ì‘ì„± ê°€ëŠ¥í•œ ê²ƒ. addTodoì—ëŠ” `type`, `text` ë¥¼ ê°€ì¡Œì§€ë§Œ, createActionì„ ì‚¬ìš©í•˜ë©´, typeê³¼ `payload` ë§Œ ë‚¨ê²Œ ëœë‹¤. actionìœ¼ë¡œ ë³´ë‚´ê³  ì‹¶ì€ ì •ë³´ëŠ” payloadì— ë‹´ê¸°ê²Œ ë¨.

```jsx
const addToDo = createAction('ADD')
const deleteToDo = createAction('DELETE')

const reducer = (state = [], action) => {
  switch (action.type) {
    case addToDo.type:
      return [{ text: action.payload, id: Date.now() }, ...state]  // ğŸŒˆ
    case deleteToDo.type:
      return state.filter(toDo => toDo.id !== action.payload)
    default:
      return state
  }
}
```

- ğŸŒˆ: ë”°ë¼ì„œ ì´ ë¶€ë¶„ì„ `payload` ë¡œ ì‚¬ìš©í•´ì•¼ í•¨.

<br/>

## createReducer

```jsx
const reducer = (state = [], action) => {
  switch (action.type) {
    case addToDo.type:
      return [{ text: action.payload, id: Date.now() }, ...state];
    case deleteToDo.type:
      return state.filter((toDo) => toDo.id !== action.payload);
    default:
      return state;
  }
}
```

ì´ë ‡ê²Œ ìˆë˜ ë¦¬ë“€ì„œ ì½”ë“œë¥¼,

```jsx
import { createAction, createReducer } from '@reduxjs/toolkit'

(...)

const reducer = createReducer([], {
  [addToDo]: (state, action) => {
    state.push({ text: action.payload, id: Date.now() })
  },
  [deleteToDo]: (state, action) =>
    state.filter(toDo => toDo.id !== action.payload),
})
```

ì´ë ‡ê²Œ ìˆ˜ì •í•´ì¤„ ìˆ˜ ìˆë‹¤. createReducerì˜ ì²« ì¸ìëŠ” initialStateì„. ë‘ë²ˆì§¸ ì¸ìëŠ” actionì„ ë„£ì–´ì¤€ë‹¤ê³  ë³´ë©´ ë¨.

createReducerë¥¼ ì‚¬ìš©í•  ë•ŒëŠ” ë‘ ê°€ì§€ ì˜µì…˜ì´ ìˆë‹¤.

1. stateë¥¼ ë³€ê²½ í•  ìˆ˜ ìˆê²Œ í•´ì¤Œ.
   - `addTodo` ë¥¼ ë³´ì. ê°ì²´ë¥¼ return í•´ì¤Œìœ¼ë¡œì¨ immerê°€ ì ìš©ëœ ì±„ë¡œ ë¶ˆë³€ì„± ê´€ë¦¬ì— ì‹ ê²½ì“°ì§€ ì•Šê³  ê·¸ëƒ¥ stateë¥¼ ë³€ê²½í•´ì¤¬ë‹¤.
2. ì›ë˜ í•˜ë˜ëŒ€ë¡œ ìƒˆë¡œìš´ stateë¥¼ return í•´ì¤„ ìˆ˜ ìˆìŒ.
   - ë‹¨ìˆœíˆ stateë¥¼ return í•˜ë ¤ê³  í•  ë•ŒëŠ” filter ì²˜ëŸ¼ ìƒˆë¡œìš´ stateì—¬ì•¼ í•¨. ì¦‰, ê°ì²´ ìƒíƒœë¥¼ returní•œê²Œ ì•„ë‹ˆë¼ ê·¸ëƒ¥ ìƒˆë¡œìš´ stateë¥¼ ë¦¬í„´í•´ì¤Œ. immer ì ìš©ì´ ì•ˆëœ ê²ƒì´ë‹¤.

<br/>

## configureStore

```jsx
import { createAction, createReducer, configureStore } from '@reduxjs/toolkit'

(...)
const store = configureStore({ reducer });  // ì›ëœ createStore(reducer) ì„
```

ì´ë ‡ê²Œ toolkitì—ì„œ ì§€ì›í•˜ëŠ” `configureStore` ë¥¼ í•˜ë©´, extension Redux devtoolsê°€ ì•Œì•„ì„œ í™œì„±í™” ë¨. ì¼ë¶€ëŸ¬ ê¹”ê³  ì…íˆê³  ì•ˆí•´ë„ ë¨.

ë‹¤ë¥¸ ì˜ˆì‹œ

```js
import {
  configureStore,
  combineReducers, // reduxì˜ ê·¸ê²ƒê³¼ ê°™ë‹¤.
  getDefaultMiddleware
} from "@reduxjs/toolkit";
import todosSlices from "src/features/todos/todosSlice";
import counter from "src/features/counter/counterReducer";

const rootReducer = combineReducers({
  counter, // createReducerë¡œ ë§Œë“  ë¦¬ë“€ì„œ ê°ì²´
  todos: todosSlices.reducer // createSliceë¡œ ë§Œë“  slice ê°ì²´ê°€ ê°€ì§„ reducer
});

const store = configureStore({
  reducer: rootReducer
});
```

ë˜ëŠ”,

```js
import logger from "redux-logger";

const store = configureStore({
  reducer: rootReducer,
  middleware: [...getDefaultMiddleware(), logger]
});
```

<br/>

## createSlice

action + reducer => slice. ì•¡ì…˜ì´ë‚˜ ë¦¬ë“€ì„œ ì™¸ì—ë„ ë‹¤ë¥¸ ë°©ì‹ìœ¼ë¡œ ìƒíƒœë¥¼ ê´€ë¦¬í•  ìˆ˜ ìˆëŠ” ë„êµ¬ë¥¼ ì œê³µí•œë‹¤. ì•¡ì…˜ê³¼ ë¦¬ë“€ì„œë¥¼ í•œë²ˆì— ë§Œë“œëŠ” ê²ƒì„.

```jsx
import { createAction, createReducer, configureStore } from '@reduxjs/toolkit'

const addToDo = createAction('ADD')
const deleteToDo = createAction('DELETE')

const reducer = createReducer([], {
  [addToDo]: (state, action) => {
    state.push({ text: action.payload, id: Date.now() })
  },
  [deleteToDo]: (state, action) =>
    state.filter(toDo => toDo.id !== action.payload),
})

const store = configureStore({ reducer })

export const actionCreators = {
  addToDo,
  deleteToDo,
}

export default store
```

ê¸°ì¡´ ì½”ë“œë‹¤. ì´ê±¸ createSliceë¡œ ë°”ê¿”ë³´ì.

```jsx
import { configureStore, createSlice } from '@reduxjs/toolkit'

const toDos = createSlice({
  // ì•¡ì…˜ íƒ€ì…ì˜ ë¬¸ìì—´ì˜ prefixë¡œ ë“¤ì–´ê°„ë‹¤. ex) "toDosReducer/add", "toDosReducer/remove"
  name: 'toDosReducer',
  initialState: [],
  reducers: {
    // ë¦¬ë“€ì„œì™€ ì•¡ì…˜ ìƒì„±ìê°€ ë¶„ë¦¬ë˜ì–´ ìˆë‹¤.
    add: (state, action) => {
      state.push({ text: action.payload, id: Date.now() })
    },
    remove: (state, action) => state.filter(toDo => toDo.id !== action.payload),
  },
})

const store = configureStore({ reducer: toDos.reducer })

export const { add, remove } = toDos.actions

export default store;
```

<br/>

## Selector

reselectë¥¼ ë‚´ë¶€ì ìœ¼ë¡œ ì‚¬ìš©í•œë‹¤. vueì˜ gettersë‘ ë¹„ìŠ·í•˜ë‹¤ê³  ìƒê°í•˜ë©´ëœë‹¤. ë©”ëª¨ì´ì œì´ì…˜ì„ ì§€ì›í•¨. conventionì€ `get-*` ëŒ€ì‹  `select-*` ë¥¼ ê¶Œì¥í•˜ê³  ìˆìŒ.

```json
const selectActiveList = createSelector(
  state => state.events.live, // ìƒíƒœ 1 ë¦¬í„´ í•¨ìˆ˜
  state => state.events.closed, // ìƒíƒœ 2 ë¦¬í„´ í•¨ìˆ˜
  state => state.events.tab, // ìƒíƒœ 3 ë¦¬í„´ í•¨ìˆ˜

  // ìƒíƒœ 1, 2, 3ì´ ì°¨ë¡€ë¡œ ë“¤ì–´ê°„ë‹¤
  (liveEvents, closedEvents, tab) => {
    switch (tab) {
      case "LIVE":
        return liveEvents;

      case "CLOSED":
        return closedEvents;

      default:
        return [];
    }
  }
);
```

ì´ë ‡ê²Œ ë§Œë“  ì…€ë ‰í„°ëŠ” reactì—ì„œ ì•„ë˜ ì½”ë“œì™€ ê°™ì´ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.

```jsx
import React from "react";
import { useSelector } from "react-redux";

export default function EventList() {
  const activeTabEvents = useSelector(selectorActiveTabEvents);

  return activeTabEvents.map((eventData, i) => (
    <span key={i}>{eventData.title}</span>
  ));
}
```
