# Next-redux-wrapper

nextì— reduxë¥¼ ë¶™ì´ë ¤ë©´ í“¨ì–´ react ì™€ëŠ” ë°©ì‹ì´ ì¡°ê¸ˆ ë‹¤ë¥´ë‹¤. ê·¸ëŸ´ ë•Œ, nextì—ì„œ ì œê³µí•˜ëŠ” `next-redux-wrapper` ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•˜ì. ë‹¨, ì‘ì„±í•˜ëŠ” ì‹œì ì—ì„œ, next-redux-wrapperëŠ” 6 ë²„ì „ìœ¼ë¡œ í•œë‹¤.

```sh
$ npm i redux react-redux next-redux-wrapper
```

<br/>

## Reduer ë§Œë“¤ê¸°

ìµœìƒìœ„ í´ë”ì— reducers/index.js ë¥¼ ë§Œë“¤ì.

```jsx
import { HYDRATE } from 'next-redux-wrapper';  // ğŸ’§

const initialState = {
  user: {
    isLoggedIn: false,
    user: null,
    signUpData: {},
    loginData: {},
  },
  post: {
    mainPosts: [],
  },
};

// action creator
export const login = (data) => {
  return {
    type: 'LOG_IN',
    data,
  };
};

// (ì´ì „ìƒíƒœ, ì•¡ì…˜) => ë‹¤ìŒìƒíƒœ
const rootRuducer = (state = initialState, action) => {
  switch (action.type) {
    case HYDRATE:  // ğŸ‘»
      // console.log('HYDRATE', action);
      return { ...state, ...action.payload };
    case 'LOG_IN':
      return {
        ...state,
        user: {
          ...state.user,
          isLoggedIn: true,
          user: action.data,  // ğŸŒˆ
        },
      };
    default:
      return state;
  }
};

export default rootRuducer;
```

- ğŸ’§: ì„œë²„ì‚¬ì´ë“œ ë Œë”ë§ì„ ìœ„í•´ HYDRATE í•˜ì´ë“œë ˆì´íŠ¸ë¥¼ ë„£ì–´ì£¼ì–´ì•¼ í•œë‹¤.
- ğŸ‘»: ì—¬ê¸° ë¦¬ë“€ì„œì—ì„œë„ í•„ìš”í•˜ê² ì§€?
- ğŸŒˆ: ê°ì²´ì˜ ë¶ˆë³€ì„±ì„ ìœ ì§€í•˜ê¸°ìœ„í•´ â€¦ í‚¤ì›Œë“œë¥¼ ì´ìš©í•´ì„œ ë°”ê¾¸ê³  ì‹¶ì€ ë…€ì„ë“¤ë§Œ ë°”ê¿”ì¤Œ.

<br/>

## Store ë§Œë“¤ê¸°

ë¨¼ì € ìµœìƒìœ„ í´ë”ì—, store/configureStore.js íŒŒì¼ì„ ë§Œë“¤ì.

```jsx
// store/configureStore.js
import { createWrapper } from 'next-redux-wrapper';
import { createStore } from 'redux';
import reducer from '../reducers';

const configureStore = () => {
  const store = createStore(reducer);  // ğŸ’§
  return store;
};

const wrapper = createWrapper(configureStore, {
  debug: process.env.NODE_ENV === 'development',  // ğŸ”¥
});

export default wrapper;
```

- ğŸ’§: ì•„ê¹Œ ìœ„ì— ì‘ì„±í•œ rootReducerì„.
- ğŸ”¥: ìœ„ ì¡°ê±´ì´ trueë©´, ë¦¬ë•ìŠ¤ë¥¼ ë””ë²„ê¹… í•  ë•Œ ë„ì›€ì„ ë§ì´ ì¤Œ. ë”°ë¼ì„œ ë°°í¬ê°€ ì•„ë‹ˆë¼ ê°œë°œ ëª¨ë“œì¼ ë•Œ ë””ë²„ê¹…ì„ ì¼œì¤Œ.

ê·¸ë¦¬ê³ , _app.jsì— ì…í˜€ì£¼ì.

```jsx
// ...
import wrapper from '../store/configureStore';

const NodeBird = ({ Component }) => {
  return (
    <>
      // ...
      <Component />
    </>
  );
};

export default wrapper.withRedux(NodeBird);  // ğŸŒˆ
```

- ğŸŒˆ: ì´ë ‡ê²Œ ê°ì‹¸ì¤€ë‹¤.

next 9 ë²„ì „ì˜ ê²½ìš° `<Provider store={store} />` ë¡œ ê°ì‹¸ì£¼ëŠ” ë¶€ë¶„ì´ ìˆì—ˆëŠ”ë° ì—¬ê¸´ í”„ë¡œë°”ì´ë”ê°€ ì—†ë‹¤. 6ë²„ì „ ë¶€í„° ê°€ëŠ¥í–ˆìŒ. ì§€ê¸ˆì€ Providerë¥¼ ë„£ì–´ì£¼ë©´ ì˜¤íˆë ¤ ë¬¸ì œê°€ ë°œìƒí•œë‹¤.

<br/>

## ì»´í¬ë„ŒíŠ¸ì—ì„œ ì‚¬ìš©í•˜ê¸°

ì´ì „ì˜ `react-redux` ì™€ ê°™ì´, useDispatch, useSelector ë¥¼ ì‚¬ìš©í•˜ë©´ ë¨.

<br/>

### devTool ì…íˆê¸°

```sh
$ npm i redux-devtools-extension
```

ê·¸ë¦¬ê³  ì…í˜€ì£¼ì.

store/configureStore.js

```jsx
import { createWrapper } from 'next-redux-wrapper';
import { applyMiddleware, compose, createStore } from 'redux';
import { composeWithDevTools } from 'redux-devtools-extension';
import reducer from '../reducers';


const configureStore = () => {
  const middlewares = [];
  const enhancer =   // ğŸ’§
    process.env.NODE_ENV === 'production'
      ? compose(applyMiddleware(...middlewares))
      : composeWithDevTools(applyMiddleware(...middlewares));  // ğŸŒˆ
  const store = createStore(reducer, enhancer);
  return store;
};

const wrapper = createWrapper(configureStore, {
  debug: process.env.NODE_ENV === 'development',
});

export default wrapper;
```

- ğŸ’§: `process.env.NODE_ENV === 'production'` ì´ ì˜ë¯¸ëŠ” ë°°í¬ìš©ì´ëƒ, ì•„ë‹ˆë©´ ê°œë°œìš©ì´ëƒì— ë”°ë¼ì„œ ì…íˆëŠ” ë¯¸ë“¤ì›¨ì–´ê°€ ë‹¬ë¼ì§. enhancerëŠ” ê°œì„  ì¥ì¹˜ë¼ëŠ” ëœ».
- ğŸŒˆ: applyMiddleware([]) ì´ ë°°ì—´ ì•ˆì—ëŠ” ë¯¸ë“¤ì›¨ì–´ ì¢…ë¥˜ë“¤ì´ ë“¤ì–´ê°ˆ ê²ƒì´ë‹¤. ì¦‰, ìœ„ì— `const middlewares = [];` ì´ ë¶€ë¶„ì˜ ë°°ì—´ì˜ ì•ˆì— ë¯¸ë“¤ì›¨ì–´ë“¤ì´ ë“¤ì–´ê°ˆ ê²ƒì„.

<br/>

## ë¦¬ë“€ì„œ ë‚˜ëˆ„ê¸°

ë¦¬ë“€ì„œê°€ ê¸¸ì–´ì§ˆ ê²ƒì´ë‹¤. ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì— ë§ì¶° ë‚˜ëˆŒ ìˆ˜ ìˆë‹¤. ë‹¤ë§Œ í•©ì¹  ë•Œ, combineReducers ì—ì„œ HYDRATEë¥¼ ì„ ì–¸í–ˆë˜ ë¶€ë¶„ë„ ì ì–´ì£¼ì–´ì•¼ í•œë‹¤.

reducers/index.js

```js
import { HYDRATE } from 'next-redux-wrapper';
import { combineReducers } from 'redux';
import user from './user';
import post from './post';

const rootRuducer = combineReducers({
  // ğŸŒˆ
  index: (state = {}, action) => {
    switch (action.type) {
      case HYDRATE:
        // console.log('HYDRATE', action);
        return { ...state, ...action.payload };
      default:
        return state;
    }
  },
  // ğŸ’§
  user,
  post,
});

export default rootRuducer;
```

- ğŸŒˆ: reactì—ì„œ ì—†ë˜ index reducerê°€ ì—¬ê¸° ì´ë ‡ê²Œ ì„ ì–¸ë˜ì–´ì•¼ í•œë‹¤.
- ğŸ’§: reactì—ì„œ í•©ì³ì£¼ì—ˆë˜ ê²ƒì²˜ëŸ¼ ì´ë ‡ê²Œ í•©ì¹  ë¦¬ë“€ì„œë“¤ì„ ë„£ì–´ì¤€ë‹¤.

<br/>

## ë”ë¯¸ ë°ì´í„° ë„£ì–´ë³´ê¸°

reducers/index.js

```js
export const initialState = {
  mainPosts: [
    {
      id: 1,
      User: { id: 1, nickname: 'ì œë¡œì´ˆ' },
      content: 'ì²« ë²ˆì§¸ ê²Œì‹œê¸€ #í•´ì‹œíƒœê·¸ #ìµìŠ¤í”„ë ˆìŠ¤',
      Images: [
        { src: 'https://placeimg.com/640/480/apple' },
        { src: 'https://placeimg.com/640/480/apple' },
        { src: 'https://placeimg.com/640/480/apple' },
      ],
      Comments: [
        { User: { nickname: 'hero' }, content: 'ê°œì •íŒì´ ë‚˜ì™”ë‹¹.' },
        { User: { nickname: 'hero' }, content: 'ì–¼ë¥¸ ì‚¬ê³  ì‹¶ë„¤' },
      ],
    },
  ],
  imagePaths: [],
  postAdded: false,
};

const ADD_POST = 'ADD_POST';
export const addPost = {
  type: ADD_POST,
};

const dummyPost = {
  id: 2,
  content: 'ë”ë¯¸ë°ì´í„° ì´ë‹¤.',
  User: { id: 1, nickname: 'ì œë¡œì´ˆ' },
  Images: [],
  Comments: [],
};

const reducer = (state = initialState, action) => {
  switch (action.type) {
    case ADD_POST:
      return {
        ...state,
        mainPosts: [dummyPost, ...state.mainPosts],  // ğŸ”¥
        postAdded: true,
      };
    default:
      return state;
  }
};

export default reducer;
```

- ğŸ”¥: ì—¬ê¸°ì„œ `dummyPost` ë¥¼ ì•ì— ë„£ëŠ” ì´ìœ ëŠ”, ì•ì— ë„£ì–´ì•¼ ê²Œì‹œë¬¼ì´ ìœ„ë¡œ ì˜¬ë¼ê°€ê² ì§€?
