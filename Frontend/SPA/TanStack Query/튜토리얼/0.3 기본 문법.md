# ê¸°ë³¸ ë¬¸ë²•

```js
// ì‚¬ìš©ë²•(1)
const { data, isLoading, ... } =  useQuery(queryKey, queryFn, {
  // ...options ex) enabled, staleTime, ...
});

// ì‚¬ìš©ë²•(2)
const result = useQuery({
  queryKey,
  queryFn,
  // ...options ex) enabled, staleTime, ...
});

result.data
result.isLoading
// ...
```

```javascript
// ì‹¤ì œ ì˜ˆì œ
const getAllSuperHero = async () => {
  return await axios.get("http://localhost:4000/superheroes");
};

const { data, isLoading } = useQuery(["super-heroes"], getAllSuperHero);
```

- useQueryëŠ” ê¸°ë³¸ì ìœ¼ë¡œ 3ê°œì˜ ì¸ìë¥¼ ë°›ëŠ”ë‹¤. `QueryKey(í•„ìˆ˜)`, `queryFn(í•„ìˆ˜)`, ì„¸ë²ˆì§¸ ì¸ìê°€ `options(optional)` ì„.

<br/>

## 1. queryKey

```javascript
// (1)
const getSuperHero = async ({ queryKey }: any) => {
  const heroId = queryKey[1]; // queryKey: ['super-hero', '3']

  return await axios.get(`http://localhost:4000/superheroes/${heroId}`);
};

const useSuperHeroData = (heroId: string) => {
  // í•´ë‹¹ ì¿¼ë¦¬ëŠ” heroIdì— ì˜ì¡´
  return useQuery(["super-hero", heroId], getSuperHero);
};
```

- useQueryëŠ” ì²« ë²ˆì§¸ ì¸ìì¸ `queryKey`ë¥¼ ê¸°ë°˜ìœ¼ë¡œ `ë°ì´í„° ìºì‹±`ì„ ê´€ë¦¬í•œë‹¤.
  - ë§Œì•½, ì¿¼ë¦¬ê°€ íŠ¹ì • ë³€ìˆ˜ì— `ì˜ì¡´` í•œë‹¤ë©´ ë°°ì—´ì—ë‹¤ ì´ì–´ì„œ ë„£ì–´ì£¼ë©´ ëœë‹¤. `ex: ["super-hero", heroId, ...]`
  - êµ‰ì¥íˆ ì¤‘ìš”í•˜ë‹¤. ì˜ˆë¥¼ ë“¤ì–´, `queryClient.setQueryData` ë“±ê³¼ ê°™ì´ íŠ¹ì • ì¿¼ë¦¬ì— ì ‘ê·¼ì´ í•„ìš”í•  ë•Œ `ì´ˆê¸°ì— ì„¤ì •í•´ë‘” í¬ë§·`ì„ ì§€ì¼œì¤˜ì•¼ ì œëŒ€ë¡œ ì¿¼ë¦¬ì— ì ‘ê·¼í•  ìˆ˜ ìˆë‹¤.
  - ì•„ë˜ options ì˜ˆì œë¥¼ ë³´ë©´ queryKeyëŠ” `["super-hero", heroId]`ì´ë‹¤. ê·¸ë ‡ë‹¤ë©´ `queryClient.setQueryData` ë¥¼ ì´ìš©í•  ë•Œ ë˜‘ê°™ì´ `["super-hero", heroId]` í¬ë§·ì„ ê°€ì ¸ì•¼ í•œë‹¤. ì•ˆê·¸ëŸ¬ë©´ ì œëŒ€ë¡œ ì›í•˜ëŠ” ì¿¼ë¦¬ ì ‘ê·¼ì´ ì•ˆëœë‹¤.

## 2. queryFn

```javascript
// (2)
const getSuperHero = async (heroId: string) => {
  return await axios.get(`http://localhost:4000/superheroes/${heroId}`);
};

const useSuperHeroData = (heroId: string) => {
  return useQuery(["super-hero", heroId], () => getSuperHero(heroId));
};
```

- useQueryì˜ ë‘ ë²ˆì§¸ ì¸ìì¸ queryFnëŠ” `Promise`ë¥¼ ë°˜í™˜í•˜ëŠ” í•¨ìˆ˜ë¥¼ ë„£ì–´ì•¼í•œë‹¤.
- ì°¸ê³ ë¡œ, queryKeyì˜ ì˜ˆì œì™€ queryFn ì˜ˆì œê°€ `ì•½ê°„ ì°¨ì´ì ` ì´ ìˆë‹¤.
  - queryKey ì˜ˆì œëŠ” 2ë²ˆì§¸ queryFnì— getSuperHero í•¨ìˆ˜ë¥¼ ë°”ë¡œ ë„˜ê²¨ì£¼ê³ , getSuperHeroì—ì„œ ë§¤ê°œ ë³€ìˆ˜ë¡œ ê°ì²´ë¥¼ ë°›ì•„ì™€ í•´ë‹¹ ê°ì²´ì˜ queryKeyë¥¼ í™œìš©í•˜ê³  ìˆë‹¤.
  - queryFn ì˜ˆì œëŠ” ê·¸ëƒ¥ 2ë²ˆì§¸ queryFnì— í™”ì‚´í‘œ í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•˜ê³ , getSuperHeroì˜ ì¸ìë¡œ heroIdë¥¼ ë„˜ê²¨ì£¼ê³  ìˆë‹¤.
  - í•´ë‹¹ ë‘ ê°€ì§€ ë°©ë²•ì€ ëª¨ë‘ ì•Œì•„ì•¼ë˜ê³ , ê²°ê³¼ëŠ” ë™ì¼í•˜ë‹¤.

## 3. options

```js
// ì˜ˆ
const useSuperHeroData = (heroId: string) => {
  return useQuery(["super-hero", heroId], () => getSuperHero(heroId), {
    cacheTime: 5 * 60 * 1000, // 5ë¶„
    staleTime: 1 * 60 * 1000, // 1ë¶„
    retry: 1,
    // ...options
  });
};
```

## useQuery ì£¼ìš” ë¦¬í„´ ë°ì´í„°

```js
const { status, isLoading, isError, error, data, isFetching, ... } = useQuery(
	['colors', pageNum],
  () => fetchColors(pageNum).
)
```

- status : ì¿¼ë¦¬ ìš”ì²­ í•¨ìˆ˜ì˜ ìƒíƒœë¥¼ í‘œí˜„í•˜ëŠ” state. 4ê°€ì§€ ìˆìŒ. (string typeì„)
  - idle: ì¿¼ë¦¬ ë°ì´í„°ê°€ ì—†ê³  ë¹„ì—ˆì„ ë•Œ, `{ enabled: false }` ìƒíƒœë¡œ ì¿¼ë¦¬ê°€ í˜¸ì¶œë˜ë©´ ì´ ìƒíƒœë¡œ ì‹œì‘ëœë‹¤.
  - loading: ìºì‹œëœ ë°ì´í„° ì—†ê³  ë¡œë”©ì¤‘ ìƒíƒœ
  - error: ìš”ì²­ ì—ëŸ¬ ìƒíƒœ
  - success: ìš”ì²­ ì„±ê³µ ìƒíƒœ
- data: ì¿¼ë¦¬ í•¨ìˆ˜ê°€ ë¦¬í„´í•œ Promiseì—ì„œ resolved ëœ ë°ì´í„°
- isLoading: `ìºì‹± ëœ ë°ì´í„°ê°€ ì—†ì„ ë•Œ` ì¦‰, ì²˜ìŒ ì‹¤í–‰ëœ ì¿¼ë¦¬ì¼ ë•Œ ë¡œë”© ì—¬ë¶€ì— ë”°ë¼ true/false ê°’ ë°˜í™˜.
- isFetching: ìºì‹± ëœ ë°ì´í„°ê°€ ìˆë”ë¼ë„ ì¿¼ë¦¬ê°€ ì‹¤í–‰ë˜ë©´ ë¡œë”© ì—¬ë¶€ì— ë”°ë¼ true/falseë¡œ ë°˜í™˜.
- error: ì˜¤ë¥˜ ë°œìƒ ì‹œ ì˜¤ë¥˜ ê°ì²´
- isError: ì—ëŸ¬ê°€ ë°œìƒí•œ ê²½ìš° `true`

### [ğŸ’¡ v4ë¶€í„°ëŠ” statusì˜ idle ìƒíƒœê°’ì´ ì œê±°ë˜ê³  fetchStatusê°€ ì¶”ê°€](https://github.com/ssi02014/react-query-tutorial#-v4ë¶€í„°ëŠ”-statusì˜-idle-ìƒíƒœê°’ì´-ì œê±°ë˜ê³ -fetchstatusê°€-ì¶”ê°€)

- TanStack Query(v4) ë¶€í„°ëŠ” statusì˜ `idleì´ ì œê±°`ë˜ê³ , ìƒˆë¡œìš´ ìƒíƒœê°’ì¸ `fetchStatus`ê°€ ì¶”ê°€ëë‹¤.
- fetchStatus
  - fetching: ì¿¼ë¦¬ê°€ í˜„ì¬ ì‹¤í–‰ì¤‘ì´ë‹¤.
  - paused: ì¿¼ë¦¬ë¥¼ ìš”ì²­í–ˆì§€ë§Œ, ì ì‹œ ì¤‘ë‹¨ëœ ìƒíƒœì´ë‹¤.
  - idle: ì¿¼ë¦¬ê°€ í˜„ì¬ ì•„ë¬´ ì‘ì—…ë„ ìˆ˜í–‰í•˜ì§€ ì•ŠëŠ” ìƒíƒœì´ë‹¤.

### [ğŸ’¡ v4ë¶€í„°ëŠ” ì™œ status, fetchStatus ë‚˜ëˆ ì„œ ë‹¤ë£¨ëŠ” ê±¸ê¹Œ?](https://github.com/ssi02014/react-query-tutorial#-v4ë¶€í„°ëŠ”-ì™œ-status-fetchstatus-ë‚˜ëˆ ì„œ-ë‹¤ë£¨ëŠ”-ê±¸ê¹Œ)

- fetchStatusëŠ” HTTP ë„¤íŠ¸ì›Œí¬ ì—°ê²° ìƒíƒœì™€ ì¢€ ë” ê´€ë ¨ëœ ìƒíƒœ ë°ì´í„°ì´ë‹¤.
  - ì˜ˆë¥¼ ë“¤ì–´, statusê°€ `success` ìƒíƒœë¼ë©´ ì£¼ë¡œ fetchStatusëŠ” `idle` ìƒíƒœì§€ë§Œ, ë°±ê·¸ë¼ìš´ë“œì—ì„œ re-fetchê°€ ë°œìƒí•  ë•Œ `fetching` ìƒíƒœì¼ ìˆ˜ ìˆë‹¤.
  - statusê°€ ë³´í†µ `loading` ìƒíƒœì¼ ë•Œ fetchStatusëŠ” ì£¼ë¡œ `fetching`ë¥¼ ê°–ì§€ë§Œ, ë„¤íŠ¸ì›Œí¬ ì—°ê²°ì´ ë˜ì–´ ìˆì§€ ì•Šì€ ê²½ìš° `paused` ìƒíƒœë¥¼ ê°€ì§ˆ ìˆ˜ ìˆë‹¤.
- ì •ë¦¬í•˜ìë©´ ì•„ë˜ì™€ ê°™ë‹¤.
  - statusëŠ” `data`ê°€ ìˆëŠ”ì§€ ì—†ëŠ”ì§€ì— ëŒ€í•œ ìƒíƒœë¥¼ ì˜ë¯¸í•œë‹¤.
  - fetchStatusëŠ” ì¿¼ë¦¬ ì¦‰, `queryFn ìš”ì²­`ì´ ì§„í–‰ì¤‘ì¸ì§€ ì•„ë‹Œì§€ì— ëŒ€í•œ ìƒíƒœë¥¼ ì˜ë¯¸í•œë‹¤.
- [why-two-different-states](https://tanstack.com/query/v4/docs/react/guides/queries#why-two-different-states)

