# 클라이언트 서버

> [출처](https://maxkim-j.github.io/posts/frontend-infrastructure/)

## 프론트도 서버다

웹앱 코드를 배포해놓으면 사용자 요청 시 서버에서 가져다 준다. 당연히 트래픽도 있음. 주소창으로 요청하면 볼 수 있는 웹 페이지들은 모두 서버에서 온다. S3에 SPA를 올려놓든, 정적 웹페이지를 올려놓든, EC2에 Next같은 SSR 앱을 올려놓든, 서버리스에 올려놓든, 다양한 형태로 존재할 수 있는 서버는 프론트엔드 개발의 결과물을 서빙한다.

프론트엔드라는 개발 분야가 생기고 발전하면서 서버, 그리고 배포는 백엔드만의 전유물이 아니다. FE 배포 프로세스는 이제 백엔드와는 독립적으로 진행될 수 있고, 관점도 다르다. 프론트 배포는 백엔드 배포와 물리적으로 아무 상관이 없다.

최근 개발 시작자들은 이런 환경을 당연하게 받아들였다. 하지만 FE / BE 분리되기 전 배포는 프론트엔드가 백엔드에 종속되는 경우가 많았었다. 서버가 유저가 요구하는 모든 리소스를 보내주던 시절의 웹 개잘에서 말이다.

이제, 클라이언트 코드를 서빙하는 서버와 인프라를 안정적으로 유지할 책임이 있다.

<br/>

## 클라이언트 서빙하기

FE 인프라에서 추구해야할 목표를 크게 3가지로 잡는다.

### 안정적 서빙

안정성은 서버의 최우선 덕목이다. 클라 웹앱을 서빙하는 서버는 유저에게 클라이언트 앱을 안정적으로, 중단 없이 서빙해야 한다. 그럼, 어떤 상황에서 서버가 불안정해질까?

우선 과도한 트래픽이 있다. 과도한 트래픽은 서버가 뻗기 때문. 물론 FE 서버의 트래픽은 BE 서버와 비교해봤을 때 많이 적은 수준이다. 클라 앱을 서버에 요청해 가져오는 것은 유저가 주소창이나 링크로 웹사이트에 접근했을 때와 새로고침을 누를 때 정도만 발생, 이후는 백엔드에 여러 데이터를 여러번 요청한다. 대강 비율로 따지면 1:N 정도가 된다. 유저는 클라 웹앱에 접근한 후 한 세션에서 백엔드에 여러번 데이터를 요청할 수 있다.

하지만, 유저가 많다면 FE 서버에도 가용성을 높일 수 있는 조치가 필요하다. **프론트엔드 서버에도 트래픽은 존재하기 때문에 서버는 뻗을 수 있다**. (물론 프론트엔드 서버 가용성을 높여야할 정도라면 백엔드 트래픽은 무시무시하게 많을 것이라 예상할 수 있음)

#### AWS S3

자주 쓰이는 AWS S3는, 안정성이 99.999999% 이고 기본적으로 초당 3500~5500개 정도의 요청을 감당하기 때문에 **대형 서비스가 아닌 경우 스토리지의 가용성을 높이거나 다수의 스토리지를 사용할 필요는 없다.**

하지만 더 많은 트래픽을 감당할 수 있어야하는 경우, CDN을 이용하거나(Cloud Front), <u>Route53으로 로드 밸런싱(Client Side Load Balancing)</u>을 하는 방법 등으로 가용성을 높일 수 있다.

### 기획/조직의 의도에 맞게 서빙하기

FE 앱과 서버를 만드는 과정에서 조직의 기획과 의도를 파악, 이를 반영하는 것이 중요함. 개발중인 서비스가 검색 유입이 중요해 SSR을 도입해야 한다고 생각해보자. 기존 서비스에 SSR을 적용해야 한다면 개발 단에서 SSR하는 코드를 붙여줄 수도 있지만, 여의치 않는다면 인프라에서 <u>Iambda@edge를 이용</u>해 진행할 수도 있다.

SSR이 되는 앱을 새로 개발한다면 Next, Nuxt와 같은 SSR 프레임워크 도입을 고려할 수 있다. Next, Nuxt는 클라 앱 뿐 아니라 서버를 낀 채 빌드할 수 있기 때문에 S3 스토리지에 올리는 것 만으로 부족하고, EC2나 Elastic Beanstalk, 혹은 Lambda를 사용한 배포 방법이 필요함.

<br/>

### 쉽고 빠르게 배포

기획과 디자인이 매일 수정되고 웹사이트 문제가 있다며 채널톡으로 CS가 쏟아짐. 리뷰 직후 **yarn 명령어 한번으로 수정된 코드가 바로 적용될 수 있도록 정확하게 배포할 수 있는 시스템을 만드는 것은 매우 중요했다.** 프론트 앱 개선 속도도 빠르게 쏟아지는 버그 리포트와 기획/디자인 변경을 따라가야 했었기 때문이다.

S3와 cloud front 를 사용해 환경을 만들고, S3에 새로운 빌드 파일들을 올려놓는 동시에 CDN 캐시 삭제해(Invalidation) 바로 배포한 바를 확인할 수 있도록 yarn 명령어 스크립트를 만들 수 있다. 모든 것이 갖춰진 CI / CD 파이프라인을 구축하는 것 보다 훨씬 쉬운 일이지만, 배포를 빠르게 할 수 있다는 사실만으로 빠르게 이루어져야 하는 앱 개선이 매우 힘을 받았다.

프론트는 앱의 수정사항이 빠르게 반영되고 화면에 바로 보일 수 있도록 빠른 배포가 가능한 파이프라인을 구축할 수 있어야 하고, 이는 인프라와 자동화를 궁부해야 가능할 것이다.

<br/>

## 또한 중요한 것 - 비동기 요청 최적화

프론트 서버 인프라 생각 전에, **프론트엔드에서 백엔드로 보내는 불필요한 요청들을 줄일 수 있다면** 백엔드 대용량 트래픽 처리에 아주 직접적으로 도움을 줄 수 있다. 불필요하게 백엔드로 가는 트래픽을 **아예 없앨 수 있다는 것**이니까. 빠르게 웹 앱을 개발하다보면 화면에 데이터가 잘 뿌려지고 디자인대로 잘 나오는지만 신경을 곤두세우는 경우가 많아 백엔드로 보내는 비동기 요청 최적화에 대해 크게 생각 하지 못하게 된다. 그렇기 때문에 개발 과정에서 불필요하게 백엔드 데이터를 요청하고 있지는 않는지 봐야 함.

적당 시점이 되기 전까지 데이터를 요청하지 않도록 캐싱을 구현하다거나 하는 방법도 좋을 듯.
