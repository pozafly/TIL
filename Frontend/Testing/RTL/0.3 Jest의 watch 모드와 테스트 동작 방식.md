# Jest의 watch 모드와 테스트 동작 방식

RTL에 관한 이야기는 아니다. jest에 대한 이야기.

RTL은 vDOM으로 컴포넌트를 렌더링시킨다. 이는 vDOM을 찾는데 도움을 준다. 하지만, RTL은 **테스트러너**가 필요하다. 테스트 파일을 찾고 검증(단언)할 무언가의 환경이 필요한 것이다. 이때 jest를 사용하는 것이다. 

테스트 러너는 여러 개가 있고, Mocha, Jasmine도 있지만, RTL에서 jest를 권장한다.

<br/>

## watch 모드

`마지막 commit 이후` 변경된 파일과 연관된 테스트만 실행하는 모드.

※ 단순히 변경된 파일만 watch 하는것이 아니라, commit 과 관련되어 있다는 것이다.

우선, 기본적으로 CRA에서는 

```json
"scripts": {
  // ...
  "test": "react-scripts test",
},
```

test 명령어를 실행하면 기본적으로 watch 모드로 실행된다. 저장하면 jest에서 테스트와 관련된 변경 사항을 확인 후 테스트를 다시 실행한다. 마지막 commit을 재설정하려면 `q` 로 watch 모드를 종료하고 git commit 하면된다.

<img width="510" alt="image" src="https://github.com/pozafly/TIL/assets/59427983/782d4736-25ea-4820-bb8e-8c1e5561893a">

위는 커밋 후, 다시 test를 돌렸을 때의 터미널 사진임. '마지막 커밋 이후 변경된 파일과 연관된 테스트가 없다는 메시지'

<br/>

## jest의 원리

어떻게 jest는 테스트가 통과했다는 것을 알까?

- 2개의 인수를 가진 전역 테스트 메서드 존재
  1. 테스트의 문자열 설명 : jest에서 이 인수를 사용해 테스트에 실패하면 어디서 실패했는지 알려준다.
  2. 테스트 함수 : 성공/실패를 위해 실행한다.
- 테스트 함수에서 에러가 나면 실패를 표시한다. 그리고 단언(assert)은 예상이 틀렸을 때 에러가 발생하도록 한다.
- 따라서 에러가 없다면 테스트에 통과함.
  - 그래서 빈 테스트도 통과 되어야 한다.

```javascript
test('empty function test', () => {
  throw new Error('test failed');
});
```

이렇게 에러를 발생시키면 실패가 뜬다.

