# ì—°ê´€ê´€ê³„ ë§¤í•‘

## ë‹¨ë°©í–¥ ì—°ê´€ê´€ê³„

ìš©ì–´ ì´í•´
- **ë°©í–¥**(Direction): ë‹¨ë°©í–¥, ì–‘ë°©í–¥
- **ë‹¤ì¤‘ì„±**(Multiplicity): ë‹¤ëŒ€ì¼(N:1), ì¼ëŒ€ë‹¤(1:N), ì¼ëŒ€ì¼(1:1), ë‹¤ëŒ€ë‹¤(N:M) ì´í•´
- **ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸**(Owner): ê°ì²´ ì–‘ë°©í–¥ ì—°ê´€ê´€ê³„ëŠ” ê´€ë¦¬ ì£¼ì¸ì´ í•„ìš”

## ì—°ê´€ê´€ê³„ê°€ í•„ìš”í•œ ì´ìœ 

'ê°ì²´ì§€í–¥ ì„¤ê³„ì˜ ëª©í‘œëŠ” ììœ¨ì ì¸ ê°ì²´ë“¤ì˜ **í˜‘ë ¥ ê³µë™ì²´**ë¥¼ ë§Œë“œëŠ” ê²ƒì´ë‹¤.'

### ì˜ˆì œ ì‹œë‚˜ë¦¬ì˜¤

- íšŒì›ê³¼ íŒ€ì´ ìˆìŒ.
- íšŒì›ì€ í•˜ë‚˜ì˜ íŒ€ì—ë§Œ ì†Œì†ë  ìˆ˜ ìˆë‹¤.
- íšŒì›ê³¼ íŒ€ì€ ë‹¤ëŒ€ì¼ ê´€ê³„ë‹¤.

### ê°ì²´ë¥¼ í…Œì´ë¸”ì— ë§ì¶”ì–´ ëª¨ë¸ë§(ì—°ê´€ê´€ê³„ê°€ ì—†ëŠ” ê°ì²´)

```mermaid
---
title: "[ê°ì²´ ì—°ê´€ê´€ê³„]"
---
erDiagram
	Member {
		Long id
		Long teamId
		string userName
	}
	Team {
		Long id
		string name
	}
```

```mermaid
---
title: "[í…Œì´ë¸” ì—°ê´€ê´€ê³„]"
---
erDiagram
	Member {
		Long MEMBER_ID PK
		Long TEAM_ID FK
		string USERNAME
	}
	Team {
		Long TEAM_ID PK
		string NAME
	}
	Member }o--o| Team : ""
```

ì™¸ë˜ í‚¤ ì‹ë³„ìë¥¼ ì§ì ‘ ë‹¤ë£¸

```java {7}
Team team = new Team();  
team.setName("TeamA");  
em.persist(team);  
  
Member member = new Member();  
member.setName("member1");  
member.setTeamId(team.getId());  // ì´ ë¶€ë¶„ ì´ìƒ
// member.setTeam(team); // ì›ëœ ì´ê²Œ ì •ìƒ
em.persist(member);
```

<img width="377" alt="Image" src="https://github.com/user-attachments/assets/e163ee4e-af7f-4330-9409-405eacd8c39e" />
ì´ì œ memberë¥¼ ì°¾ê³ , í•´ë‹¹ memberì˜ teamì„ ì•Œê³  ì‹¶ë‹¤ë©´?

```java
Member findMember = em.find(Member.class, member.getId());
Long teamId = findMember.getTeamId();
Team findTeam = em.find(Team.class, teamId);
```

ì´ë ‡ê²Œ teamIdë¥¼ ê°€ì ¸ì™€ì„œ ë‹¤ì‹œ ì°¾ì•„ì•¼ í•¨. DBì— ê³„ì† ë¬¼ì–´ë´ì•¼í•˜ëŠ” ìƒí™©ì´ ìƒê¸´ë‹¤.

ì¦‰, ê°ì²´ë¥¼ í…Œì´ë¸”ì— ë§ì¶”ì–´ ë°ì´í„° ì¤‘ì‹¬ìœ¼ë¡œ ëª¨ë¸ë§í•˜ë©´, í˜‘ë ¥ ê´€ê³„ë¥¼ ë§Œë“¤ ìˆ˜ ì—†ë‹¤.

- **í…Œì´ë¸”ì€ ì™œë˜ í‚¤ë¡œ ì¡°ì¸**ì„ ì‚¬ìš©í•´ ì—°ê´€ëœ í…Œì´ë¸”ì„ ì°¾ëŠ”ë‹¤.
- **ê°ì²´ëŠ” ì°¸ì¡°**ë¥¼ ì‚¬ìš©í•´ì„œ ì—°ê´€ëœ ê°ì²´ë¥¼ ì°¾ëŠ”ë‹¤.
- í…Œì´ë¸”ê³¼ ê°ì²´ ì‚¬ì´ì—ëŠ” ì´ëŸ° í° ê°„ê²©ì´ ìˆìŒ.

## ë‹¨ë°©í–¥ ì—°ê´€ê´€ê³„

### ê°ì²´ ì§€í–¥ ëª¨ë¸ë§(ê°ì²´ ì—°ê´€ê´€ê³„ ì‚¬ìš©)

<img width="782" alt="Image" src="https://github.com/user-attachments/assets/fec196ac-6891-48a1-8eb5-4e1cfc7fca0e" />

Teamì˜ idê°€ ì•„ë‹ˆë¼ Team ê°ì²´ ì°¸ì¡° ê°’ì„ ê·¸ëŒ€ë¡œ ë“¤ê³ ì˜´.

```java {8-9}
@Entity  
public class Member {  
  
    // ...
  
    // @Column(name = "TEAM_ID")  
    // private Long teamId;  
    @ManyToOne
    @JoinColumn(name = "TEAM_ID")
    private Team team;

	// ...
}
```

`Team` ê°ì²´ ìì²´ë¥¼ ì„ ì–¸í•˜ê³ , `@ManytoOne` ì–´ë…¸í…Œì´ì…˜ì„ ë„£ì–´ì¤Œ.
ManyëŠ” Memberì´ê³ , Oneì€ Team ì´ë¼ëŠ” ì˜ë¯¸ì´ë‹¤.

ê·¸ë¦¬ê³  `@JoinColumn` ì„ í†µí•´ ì–´ë–¤ FK ë¥¼ ê°€ì ¸ì™€ idë¡œ ë§¤í•‘ì‹œí‚¬ ê²ƒì¸ì§€ ì•Œë ¤ì£¼ì–´ì•¼ í•¨. ì¦‰, ê´€ê³„ì™€ ê´€ê³„ì— joinì„ í•  ë•Œ ì–´ë–¤ ê±¸ í• ê»€ì§€ë¥¼ ì •í•´ì£¼ë©´ ëœë‹¤.

#### ORM ë§¤í•‘

<img width="827" alt="Image" src="https://github.com/user-attachments/assets/99a4deeb-d546-4662-b2b4-3c84c7daba4c" />

```java {7}
Team team = new Team();
team.setName("TeamA");
em.persist(team);

Member member = new Member();
member.setName("member1");
member.setTeam(team);  // ë‹¨ë°©í–¥ ì—°ê´€ê´€ê³„ ì„¤ì •, ì°¸ì¡° ì €ì¥
em.persist(member);
```

teamIdë¥¼ ë„£ëŠ”ê²Œ ì•„ë‹ˆë¼, `setTeam()` ìœ¼ë¡œ team ì°¸ì¡°í˜•ì„ ì§ì ‘ ë„£ì–´ì£¼ë©´ ëœë‹¤.

#### ê°ì²´ ê·¸ë˜í”„ íƒìƒ‰

```java
Member findMember = em.find(Member.class, member.getId());

// Long teamId = findMember.getTeamId();
// Team findTeam = em.find(Team.class, teamId);

// ì°¸ì¡°ë¥¼ ì‚¬ìš©í•´ ì—°ê´€ê´€ê³„ ì¡°íšŒ
Team findTeam = findMember.getTeam();
```

ê·¸ë¦¬ê³  ì°¾ì„ ê²½ìš°, DBë¥¼ teamIdë¡œ ì¡°íšŒí•˜ëŠ”ê²Œ ì•„ë‹ˆë¼, member ê°ì²´ ì•ˆì— ë“¤ì–´ìˆëŠ” Team ê°ì²´ ìì²´ë¥¼ êº¼ë‚¼ ìˆ˜ ìˆìŒ.

em.find() ì „ì—

```java
em.flush();  
em.clear();
```

ë¥¼ ë„£ì–´ì£¼ë©´ ì¿¼ë¦¬ë¥¼ ì§ì ‘ select í†µí•´ ì§ì ‘ ì¡°íšŒí•˜ëŠ” ê²½ìš°ë„ ë³¼ ìˆ˜ ìˆìŒ.

```
select
	m1_0.MEMBER_ID,
	m1_0.USERNAME,
	t1_0.TEAM_ID,
	t1_0.name 
from
	Member m1_0 
left join
	Team t1_0 
		on t1_0.TEAM_ID=m1_0.TEAM_ID 
where
	m1_0.MEMBER_ID=?
```

ì´ë ‡ê²Œ joinë¬¸ì„ ë§Œë“¤ì–´ ì¡°íšŒë¥¼ ì‹œë„í•¨.

#### ì—°ê´€ê´€ê³„ ìˆ˜ì •

```java
// ìƒˆë¡œìš´ íŒ€B
Team teamB = new Team();
teamB.setName("TeamB");
em.persist(teamB);

// íšŒì›1ì— ìƒˆë¡œìš´ íŒ€ B ì„¤ì •
member.setTeam(teamB);
```

## ì–‘ë°©í–¥ ì—°ê´€ê´€ê³„ì™€ ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸

<img width="890" alt="Image" src="https://github.com/user-attachments/assets/c0787f12-4764-49db-8600-2101789e34d9" />
í…Œì´ë¸” ì—°ê´€ê´€ê³„ëŠ” ì•„ë¬´ ë³€í™”ê°€ ì—†ë‹¤. ë‹¨, ê°ì²´ëŠ” Team ê°ì²´ ì•ˆì— members(list)ê°€ ìƒˆë¡œ ë§Œë“¤ì–´ì¡Œë‹¤. ì¦‰, Teamì— ì†Œì†ëœ memberë¥¼ ì•Œê³  ì‹¶ì„ ê²½ìš° ì‚¬ìš©í•˜ëŠ” ê²ƒì´ë‹¤.

í…Œì´ë¸”ì´ ì•„ë¬´ ë³€í™”ê°€ ì—†ëŠ” ê²ƒì€ FKë¡œ joinì„ í•˜ëŠ” ë§¤ì»¤ë‹ˆì¦˜ ë•Œë¬¸ì´ë‹¤.

```sql
select member_id, username
from team t 
	join member m on t.team_id = m.team_id;
```

| MEMBER_ID | USERNAME |
| --------- | -------- |
| 1         | member1  |
| 2         | member2  |

ì´ë ‡ê²Œ í•˜ë©´ Teamì— ì†í•œ ë©¤ë²„ê°€ ëˆ„êµ¬ì¸ì§€ ì•Œ ìˆ˜ ìˆê¸° ë•Œë¬¸ì„.

```java
@Entity  
public class Team {  
    // ...
  
    @OneToMany(mappedBy = "team")
    private List<Member> members = new ArrayList<>();
    // new ArrayList<>() ë¥¼ ë¶™ì¸ ì´ìœ ëŠ” ê´€ë¡€ì ìœ¼ë¡œ .add() í•  ê²½ìš° null í¬ì¸í„° ìµì…‰ì…˜ ëœ¨ì§€ ì•Šê²Œ í•˜ê¸° ìœ„í•¨.
    
    // ...
}
```

ì´ë ‡ê²Œ Teamì— `@OneToMany` ë¥¼ ë„£ì–´ì£¼ë©´ ëœë‹¤. Team ì…ì¥ì—ì„œ Oneì´ê³ , member ì…ì¥ì€ Many ì´ê¸° ë•Œë¬¸.
ê·¸ë¦¬ê³  `mappedBy` ì†ì„±ì„ ë„£ì–´ì£¼ì–´ì•¼ í•¨.
`mappedMy = "team"` ì—ì„œ `team` ì€

```java
@Entity  
public class Member {  
    @ManyToOne  
    @JoinColumn(name = "TEAM_ID")  
    private Team team;
}
```

Member ì—”í‹°í‹°ì˜ `Team team` ì˜ team ë©¤ë²„ ë³€ìˆ˜ ëª…ì„ ì˜ë¯¸í•œë‹¤.

**ê°ì²´ ê·¸ë˜í”„ íƒìƒ‰**

```java
Team findTeam = em.find(Team.class, team.getId());
int memberSize = findTeam.getMembers().size(); //ì—­ë°©í–¥ ì¡°íšŒ
```

í•˜ì§€ë§Œ, ê°ì²´ëŠ” ì™ ë§Œí•˜ë©´ ë‹¨ë°©í–¥ì´ ì¢‹ë‹¤.

### â­ï¸â­ï¸â­ï¸ ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸ê³¼ mappedBy

#### ê°ì²´ì™€ í…Œì´ë¸”ì´ ê´€ê³„ë¥¼ ë§ºëŠ” ì°¨ì´

- **ê°ì²´ ì—°ê´€ê´€ê³„ = 2ê°œ**
	- íšŒì› -> íŒ€ ì—°ê´€ê´€ê³„ 1ê°œ (ë‹¨ë°©í–¥)
	- íŒ€ -> íšŒì› ì—°ê´€ê´€ê³„ 1ê°œ (ë‹¨ë°©í–¥)
- **í…Œì´ë¸” ì—°ê´€ê´€ê³„ = 1ê°œ**
	- íšŒì› <-> íŒ€ì˜ ì—°ê´€ê´€ê³„ 1ê°œ (ì–‘ë°©í–¥)

#### ê°ì²´ì˜ ì–‘ë°©í–¥ ê´€ê³„

- ê°ì²´ì˜ **ì–‘ë°©í–¥ ê´€ê³„ëŠ” ì‚¬ì‹¤ ì–‘ë°©í–¥ ê´€ê³„ê°€ ì•„ë‹ˆë¼ ì„œë¡œ ë‹¤ë¥¸ ë‹¨ë°©í–¥ ê´€ê³„ 2ê°œë‹¤.**
- ê°ì²´ë¥¼ ì–‘ë°©í–¥ìœ¼ë¡œ ì°¸ì¡°í•˜ë ¤ë©´ **ë‹¨ë°©í–¥ ì—°ê´€ê´€ê³„ë¥¼ 2ê°œ** ë§Œë“¤ì–´ì•¼ í•¨.
	- A -> B (a.getB())
	- B -> A (b.getA())

#### í…Œì´ë¸”ì˜ ì–‘ë°©í–¥ ì—°ê´€ê´€ê³„

- í…Œì´ë¸”ì€ **ì™¸ë˜ í‚¤ í•˜ë‚˜**ë¡œ ë‘ í…Œì´ë¸”ì˜ ì—°ê´€ê´€ê³„ë¥¼ ê´€ë¦¬
- `MEMBER.TEAM_ID` ì™¸ë˜ í‚¤ í•˜ë‚˜ë¡œ ì–‘ë°©í–¥ ì—°ê´€ê´€ê³„ ê°€ì§ (ì–‘ìª½ìœ¼ë¡œ ì¡°ì¸í•  ìˆ˜ ìˆë‹¤.)

```sql
SELECT *
FROM MEMBER M
JOIN TEAM T ON M.TEAM_ID = T.TEAM_ID

SELECT *
FROM TEAM T
JOIN MEMBER M ON T.TEAM_ID = M.TEMA_ID
```

#### ë‘˜ ì¤‘ í•˜ë‚˜ë¡œ ì™¸ë˜ í‚¤ ê´€ë¦¬í•´ì•¼ í•¨

<img width="919" alt="Image" src="https://github.com/user-attachments/assets/06e1ab9a-807d-4ffe-8ee4-33f755ed07f4" />
ë§Œì•½ memberì˜ team ì„ ë³€ê²½í•˜ê³  ì‹¶ìœ¼ë©´ ì–´ë–»ê²Œ í•´ì•¼í•˜ë‚˜?
- Member ê°ì²´ì˜ team ì„ ë³€ê²½í•´ì•¼ í•˜ë‚˜?
- Teamì˜ members(list)ë¥¼ ë³€ê²½í•´ì•¼ í•˜ë‚˜?
- í•˜ì§€ë§Œ, MEMBER í…Œì´ë¸”ì˜ ì…ì¥ì—ì„  team_idë§Œ ë³€ê²½í•˜ë©´ ë¨.

ê·¹ë‹¨ì ìœ¼ë¡œ member ê°ì²´ì˜ team ê°’ì€ ë³€ê²½í–ˆì§€ë§Œ, team ê°ì²´ì˜ membersëŠ” ë³€ê²½í•´ì£¼ì§€ ì•Šì•˜ìŒ. ê·¸ëŸ¬ë©´ ì˜¤ë¥˜ê°€ ë°œìƒ.

ë”°ë¼ì„œ, Member ê°ì²´ì˜ teamìœ¼ë¡œ ì™¸ë˜í‚¤ë¥¼ ê´€ë¦¬í• ì§€, Teamê°ì²´ì˜ members(list)ì—ì„œ ì™¸ë˜ í‚¤ë¥¼ ê´€ë¦¬í• ì§€ ì •í•´ì•¼ í•œë‹¤.

#### ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸(Owner)

ì–‘ë°©í–¥ ë§¤í•‘ ê·œì¹™
- ê°ì²´ì˜ ë‘ ê´€ê³„ ì¤‘ í•˜ë‚˜ë¥¼ ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸ìœ¼ë¡œ ì§€ì •
- **ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸ë§Œì´ ì™¸ë˜ í‚¤ë¥¼ ê´€ë¦¬(ë“±ë¡, ìˆ˜ì •)**
- **ì£¼ì¸ì´ ì•„ë‹Œ ìª½ì€ ì½ê¸°ë§Œ ê°€ëŠ¥**
- ì£¼ì¸ì€ mappedBy ì†ì„± ì‚¬ìš© X
- ì£¼ì¸ì´ ì•„ë‹ˆë©´ mappedBy ì†ì„±ìœ¼ë¡œ ì£¼ì¸ ì§€ì •

#### ëˆ„êµ¬ë¥¼ ì£¼ì¸ìœ¼ë¡œ?

- ì™¸ë˜ í‚¤ê°€ ìˆëŠ” ê³³ì„ ì£¼ì¸ìœ¼ë¡œ ì •í•´ë¼
- ì—¬ê¸°ì„œëŠ” `Member.team` ì´ ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸

<img width="765" alt="Image" src="https://github.com/user-attachments/assets/c3577704-3d0d-4fea-8d72-19cf83be14e2" />
ğŸ“Œ Memberì˜ teamì„ ì£¼ì¸ìœ¼ë¡œ ë‘ëŠ” ê²ƒì„ ì¶”ì²œí•œë‹¤. ì¦‰, Manyìª½ì— FKë¥¼ ê´€ë¦¬í•˜ë„ë¡ í•˜ëŠ” ê²ƒì´ ì¢‹ë‹¤.
- ì´ìœ ëŠ”, members(list) ë¥¼ ë³€ê²½ í•œë‹¤ê³  ê°€ì •
- ê·¸ëŸ¬ë©´ Member tableì—ë„ update ì¿¼ë¦¬ê°€ ë°œìƒí•œë‹¤.
- team ì•ˆì˜ membersë¥¼ ë³€ê²½í–ˆëŠ”ë° TEAM, MEMBER ë‘ í…Œì´ë¸” ëª¨ë‘ SQLì´ ë°œìƒë˜ì–´ ë²„ë¦¼.
- ê·¸ë ‡ê²Œ ë˜ë©´ í—·ê°ˆë¦¼.
í•˜ì§€ë§Œ,
- Member ê°ì²´ì˜ teamë§Œ ë³€ê²½í•˜ë©´
- Team ê°ì²´ì˜ members(list)ë„ ë³€ê²½ì€ ë˜ì§€ë§Œ
- tableì„ ë³€ê²½í•˜ëŠ” sqlì€ ë°œìƒí•˜ì§€ ì•ŠìŒ. (ë‹¨ìˆœ ê°ì²´ ì½ê¸°ë§Œ í•˜ë¯€ë¡œ)
- í—·ê°ˆë¦¼ì´ ì¤„ì–´ë“¦.

#### ì–‘ë°©í–¥ ë§¤í•‘ì‹œ ê°€ì¥ ë§ì´ í•˜ëŠ” ì‹¤ìˆ˜

ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸ì— ê°’ì„ ì…ë ¥í•˜ì§€ ì•ŠìŒ.

```java
Member member = new Member();  
member.setName("member1");

Team team = new Team();  
team.setName("TeamA");  
// ì—­ë°©í–¥ (ì£¼ì¸ì´ ì•„ë‹Œ ë°©í–¥)ë§Œ ì—°ê´€ê´€ê³„ ì„¤ì •
team.getMembers().add(member);  
em.persist(team);
```
