# ì—”í‹°í‹° ê°œë°œ

> - ì˜ˆì œì—ì„œëŠ” ì„¤ëª… ë•Œë¬¸ì— Getter, Setter ëª¨ë‘ ì—´ê³  ë‹¨ìˆœ ì„¤ê³„.
> - í•˜ì§€ë§Œ, ì‹¤ë¬´ì—ì„œëŠ” GetterëŠ” ì—´ê³  SetterëŠ” í•„ìš”í•œ ë¶€ë¶„ë§Œ ë„£ê¸°.

> ğŸ“Œ ì´ë¡ ì ìœ¼ë¡œëŠ” Getter, Setter ëª¨ë‘ ì œê³µí•˜ì§€ ì•Šê³  ê¼­ í•„ìš”í•œ ë³„ë„ ë©”ì„œë“œë¥¼ ì œê³µí•˜ëŠ”ê²Œ ê°€ì¥ ì´ìƒì .
> í•˜ì§€ë§Œ ì‹¤ë¬´ì—ì„œ ì—”í‹°í‹° ë°ì´í„°ëŠ” ì¡°íšŒí•  ì¼ì´ ë„ˆë¬´ ë§ìœ¼ë¯€ë¡œ Getterì˜ ê²½ìš° ì—´ì–´ë‘ëŠ” ê²ƒì´ í¸ë¦¬. GetterëŠ” ì•„ë¬´ë¦¬ í˜¸ì¶œí–ë„ í˜¸ì¶œ ë§Œìœ¼ë¡œ ì‚¬ì´ë“œ ì´í™íŠ¸ ë°œìƒ X. í•˜ì§€ë§Œ Setterë¥¼ í˜¸ì¶œí•˜ë©´ ë°ì´í„°ê°€ ë³€ê²½ë¨. Setterë¥¼ ë§‰ ì—´ì–´ë‘ë©´ ë¯¸ë˜ì— ì—”í‹°í‹°ê°€ ë„ëŒ€ì²´ ì™œ ë³€ê²½ë˜ëŠ”ì§€ ì¶”ì í•˜ê¸° ì–´ë ¤ì›Œì§. ì—”í‹°í‹°ë¥¼ ë³€ê²½í•  ë•ŒëŠ” Setter ëŒ€ì‹  ë³€ê²½ ì§€ì ì´ ëª…í™•í•˜ë„ë¡ ë³€ê²½ì„ ìœ„í•œ ë¹„ì¦ˆë‹ˆìŠ¤ ë©”ì„œë“œë¥¼ ë³„ë„ë¡œ ì œê³µí•´ì•¼ í•¨.

## ID

ì—”í‹°í‹°ì˜ ì‹ë³„ìëŠ” `id` ë¥¼ ì‚¬ìš©í•˜ê³  PK ì»¬ëŸ¼ëª…ì€ `member_id` ë¥¼ ì‚¬ìš©í•¨. ì—”í‹°í‹°ëŠ” íƒ€ì…(ì—¬ê¸°ì„œëŠ” `Member`) ì´ ìˆìœ¼ë¯€ë¡œ `id` í•„ë“œë§Œ ì‰½ê²Œ êµ¬ë¶„í•  ìˆ˜ ìˆë‹¤. í…Œì´ë¸”ì€ íƒ€ì…ì´ ì—†ìœ¼ë¯€ë¡œ êµ¬ë¶„ì´ ì–´ë µë‹¤. ê·¸ë¦¬ê³  í…Œì´ë¸”ì€ ê´€ë¡€ìƒ `í…Œì´ë¸”ëª… + id` ë¥¼ ë§ì´ ì‚¬ìš©í•¨. ì°¸ê³ ë¡œ ê°ì²´ì—ì„œ `id` ëŒ€ì‹  `memberId` ë¥¼ ì‚¬ìš©í•´ë„ ëœë‹¤. ì¤‘ìš”í•œ ê²ƒì€ ì¼ê´€ì„±.

## @ManyToMany

ì‹¤ë¬´ì—ì„œëŠ” `@ManyToMany` ì‚¬ìš©í•˜ì§€ë§ì. í¸ë¦¬í•  ê²ƒ ê°™ì§€ë§Œ ì¤‘ê°„ í…Œì´ë¸”(`CATEGORY_ITEM`)ì— ì¹¼ëŸ¼ì„ ì¶”ê°€í•  ìˆ˜ ì—†ê³ , ì„¸ë°€í•˜ê²Œ í€´ë¦¬ë¥¼ ì‹¤í–‰í•˜ê¸° ì–´ë µê¸° ë•Œë¬¸ì— ì‹¤ë¬´ì—ì„œ ì‚¬ìš©í•˜ê¸°ì—ëŠ” í•œê³„ê°€ ìˆìŒ. ì¤‘ê°„ ì—”í‹°í‹°(`CategoryItem`)ë¥¼ ë§Œë“¤ê³  `@ManyToOne`, `@OneToMany` ë¡œ ë§¤í•‘í•´ ì‚¬ìš©í•˜ì. ì •ë¦¬í•˜ë©´ ë‹¤ëŒ€ë‹¤ ë§¤í•‘ì„ ì¼ëŒ€ë‹¤, ë‹¤ëŒ€ì¼ ë§¤í•‘ìœ¼ë¡œ í’€ì–´ë‚´ì.

## ê°’ íƒ€ì…

```java
@Embeddable  
@Getter  
public class Address {  
  
    private String city;  
    private String street;  
    private String zipcode;  
  
    protected Address() {  
    }  
  
    public Address(String city, String street, String zipcode) {  
        this.city = city;  
        this.street = street;  
        this.zipcode = zipcode;  
    }  
}
```

ê°’ íƒ€ì…ì€ ë³€ê²½ ë¶ˆê°€ëŠ¥í•˜ê²Œ í•´ì•¼ í•¨. `@Setter` ì œê±°í•˜ê³  ìƒì„±ìì—ì„œ ê°’ì„ ëª¨ë‘ ì´ˆê¸°í™”í•´ ë³€ê²½ ë¶ˆê°€ëŠ¥í•œ í´ë˜ìŠ¤ë¥¼ ë§Œë“¤ì. JPA ìŠ¤íŒ© ìƒ ì—”í‹°í‹°ë‚˜ ì„ë² ë””ë“œ íƒ€ì…(`@Embeddeable`)ì€ ìë°” ê¸°ë³¸ ìƒì„±ì(default constructor) ë¥¼ `public` ë˜ëŠ” `protected`ë¡œ ì„¤ì •í•´ì•¼ í•¨. `public`ìœ¼ë¡œ ë‘ëŠ” ê²ƒë³´ë‹¤ëŠ” `protected`ë¡œ ì„¤ì •í•˜ëŠ” ê²ƒì´ ê·¸ë‚˜ë§ˆ ë” ì•ˆì „ í•¨.
JPAê°€ ì´ëŸ° ì œì•½ì„ ë‘ëŠ” ì´ìœ ëŠ” JPA êµ¬í˜„ ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ ê°ì²´ë¥¼ ìƒì„±í•  ë•Œ ë¦¬í”Œë ‰ì…˜ ê°™ì€ ê¸°ìˆ ì„ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ ì§€ì›í•´ì•¼ í•˜ê¸° ë•Œë¬¸ì„.

## cascade

```java {4}
public class Order {
	// ...
	
	@OneToMany(mappedBy = "order", cascade = CascadeType.ALL)  
	private List<OrderItem> orderItems = new ArrayList<>();
}
```

cascadeë¥¼ ALL ë¡œ ì„¤ì •í•´ë‘ë©´, Orderë¥¼ ì €ì¥í•˜ë©´ OrderItemsë„ ê°™ì´ ì €ì¥ëœë‹¤.
ì¦‰ ì›ë˜ëŠ” ì•„ë˜ ì½”ë“œì™€ ê°™ì´ í•´ì•¼ í•¨.

```java
persist(orderItemA);
persist(orderItemB);
persist(orderItemC);

persist(order);
```

ì €ë ‡ê²Œ cascade ì„¤ì • í•´ë‘ë©´,

```java
persist(order);
```

ì´ ì½”ë“œë§Œìœ¼ë¡œ ë‹¤ ì €ì¥ëœë‹¤.

## ì—°ê´€ê´€ê³„ í¸ì˜ ë©”ì„œë“œ

```java
public class Order {
	// ...
	
	// ==ì—°ê´€ê´€ê³„ í¸ì˜ ë©”ì„œë“œ==  
	public void setMember(Member member) {  
	    this.member = member;  
	    member.getOrders().add(this);  
	}  
	  
	public void addOrderItem(OrderItem orderItem) {  
	    orderItems.add(orderItem);  
	    orderItem.setOrder(this);  
	}  
	  
	public void setDelivery(Delivery delivery) {  
	    this.delivery = delivery;  
	    delivery.setOrder(this);  
	}
}

```

ë‹¨ë°©í–¥ ë˜ëŠ” ì–‘ë°©í–¥ ì—°ê´€ê´€ê³„ë¥¼ ë§ºì—ˆë‹¤ë©´ ì´ëŸ° ì‹ìœ¼ë¡œ ë‘ê°œì˜ ê°ì²´ ëª¨ë‘ setì„ í•´ì£¼ì–´ì•¼ í•  ê²½ìš° ìŠì–´ë²„ë¦¬ê¸° ì‰¬ìš°ë¯€ë¡œ ì €ë ‡ê²Œ ë„£ì–´ì£¼ëŠ”ê²Œ ì¢‹ë‹¤. ë‹¨, ë‹¤ ìª½ì´ë‚˜ ì¼ ìª½ì´ë‚˜ ìƒê´€ì—†ì´ ë§ì´ ì“°ëŠ” ìª½ì— ì„¸íŒ…í•˜ëŠ”ê²Œ ì¢‹ìŒ.

## ì—”í‹°í‹° ì„¤ê³„ì‹œ ì£¼ì˜ì 

### ì—”í‹°í‹°ì—ëŠ” ê°€ê¸‰ì  Setterë¥¼ ì‚¬ìš©í•˜ì§€ ë§ì

setterê°€ ëª¨ë‘ ì—´ë ¤ìˆë‹¤. ë³€ê²½ í¬ì¸íŠ¸ê°€ ë„ˆë¬´ ë§ì•„ ìœ ì§€ë³´ìˆ˜ê°€ ì–´ë µë‹¤. ë‚˜ì¤‘ì— ë¦¬í™í† ë§ìœ¼ë¡œ Setter ì œê±°.

### ëª¨ë“  ì—°ê´€ê´€ê³„ëŠ” ì§€ì—°ë¡œë”©ìœ¼ë¡œ ì„¤ì •!

- ì¦‰ì‹œë¡œë”©(`EAGER`)ì€ ì˜ˆì¸¡ì´ ì–´ë µê³ , ì–´ë–¤ SQLì´ ì‹¤í–‰ë ì§€ ì¶”ì í•˜ê¸° ì–´ë ¤ì›€. íŠ¹íˆ JPQLì„ ì‹¤í–‰í•  ë•Œ N+1 ë¬¸ì œê°€ ìì£¼ ë°œìƒí•¨.
- ì‹¤ë¬´ì—ì„œ ëª¨ë“  ì—°ê´€ê´€ê³„ëŠ” ì§€ì—°ë¡œë”©(`LAZY`) ì‚¬ìš©.
- ì—°ê´€ëœ ì—”í‹°í‹°ë¥¼ í•¨ê»˜ DBì—ì„œ ì¡°íšŒí•´ì•¼ í•˜ë©´, feetch join ë˜ëŠ” ì—”í‹°í‹° ê·¸ë˜í”„ ê¸°ëŠ¥ì„ ì‚¬ìš©í•œë‹¤.
- @XToOne(OneToOne, ManyToOne) ê´€ê³„ëŠ” ê¸°ë³¸ì´ ì¦‰ì‹œ ë¡œë”©ì´ë¯€ë¡œ ì§ì ‘ ì§€ì—°ë¡œë”©ìœ¼ë¡œ ì„¤ì •í•´ì•¼ í•¨.

### ì»¬ë ‰ì…˜ì€ í•„ë“œì—ì„œ ì´ˆê¸°í™” í•˜ì

- ì»¬ë ‰ì…˜ì€ í•„ë“œì—ì„œ ë°”ë¡œ ì´ˆê¸°í™” í•˜ëŠ” ê²ƒì´ ì•ˆì „í•˜ë‹¤.
- `null` ë¬¸ì œì—ì„œ ì•ˆì „í•˜ë‹¤.
- í•˜ì´ë²„ë„¤ì´íŠ¸ëŠ” ì—”í‹°í‹°ë¥¼ ì˜ì†í™”í•  ë•Œ, ì»¬ë ‰ì…˜ì„ ê°ì‹¸ì„œ í•˜ì´ë²„ë„¤ì´íŠ¸ê°€ ì œê³µí•˜ëŠ” ë‚´ì¥ ì»¬ë ‰ì…˜ìœ¼ë¡œ ë³€ê²½í•œë‹¤. ë§Œì•½ `getOrders()` ì²˜ëŸ¼ ì„ì˜ì˜ ë©”ì„œë“œì—ì„œ ì»¬ë ‰ì…˜ì„ ì˜ëª» ìƒì„±í•˜ë©´ í•˜ì´ë²„ë„¤ì´íŠ¸ ë‚´ë¶€ ë§¤ì»¤ë‹ˆì¦˜ì— ë¬¸ì œê°€ ë°œìƒí•  ìˆ˜ ìˆë‹¤. ë”°ë¼ì„œ í•„ë“œë ˆë²¨ì—ì„œ ìƒì„±í•˜ëŠ” ê²ƒì´ ê°€ì¥ ì•ˆì „í•˜ê³ , ì½”ë“œë„ ê°„ê²°í•˜ë‹¤.

```java
Member member = new Member();
System.out.println(member.getOrders().getClass());
em.persist(team);
System.out.println(member.getOrders().getClass());

// ì¶œë ¥ ê²°ê³¼
class java.util.ArrayList
class org.hibernate.collection.internal.PersistentBag
```

### í…Œì´ë¸”, ì»¬ëŸ¼ëª… ìƒì„± ì „ëµ

ìŠ¤í”„ë§ ë¶€íŠ¸ì—ì„œ í•˜ì´ë²„ë„¤ì´íŠ¸ ê¸°ë³¸ ë§¤í•‘ ì „ëµì„ ë³€ê²½í•´ì„œ ì‹¤ì œ í…Œì´ë¸” í•„ë“œëª…ì€ ë‹¤ë¦„

- https://docs.spring.io/spring-boot/docs/2.1.3.RELEASE/reference/htmlsingle/#howto-configure-hibernate-naming-strategy
- http://docs.jboss.org/hibernate/orm/5.4/userguide/html_single/Hibernate_User_Guide.html#naming

í•˜ì´ë²„ë„¤ì´íŠ¸ ê¸°ì¡´ êµ¬í˜„: ì—”í‹°í‹°ì˜ í•„ë“œëª…ì„ ê·¸ëŒ€ë¡œ í…Œì´ë¸”ì˜ ì»¬ëŸ¼ëª…ìœ¼ë¡œ ì‚¬ìš© (`SpringPhysicalNamingStrategy`)

#### ìŠ¤í”„ë§ ë¶€íŠ¸ ì‹ ê·œ ì„¤ì • (ì—”í‹°í‹°(í•„ë“œ) í…Œì´ë¸”(ì»¬ëŸ¼))

1. ì¹´ë©œ ì¼€ì´ìŠ¤ -> ì–¸ë”ìŠ¤ì½”ì–´(memberPoint -> member_point)
2. .(ì ) -> \_(ì–¸ë”ìŠ¤ì½”ì–´)
3. ëŒ€ë¬¸ì -> ì†Œë¬¸ì

ì ìš© 2ë‹¨ê³„

1. ë…¼ë¦¬ì  ìƒì„±: ëª…ì‹œì ìœ¼ë¡œ ì»¬ëŸ¼, í…Œì´ë¸” ëª…ì„ ì§ì ‘ ì ì§€ ì•Šìœ¼ë©´ ImplicitNamingStrategy ì‚¬ìš©
    `sprint.jpa.hibernate.naming.implicit-strategy`: í…Œì´ë¸”ì´ë‚˜, ì»¬ëŸ¼ëª…ì„ ëª…ì‹œí•˜ì§€ ì•Šì„ ë•Œ ë…¼ë¦¬ëª… ì ìš©,
2. ë¬¼ë¦¬ëª… ì ìš©:
	`spring.jpa.hibernate.naming.physical-strategy`: ëª¨ë“  ë…¼ë¦¬ëª…ì— ì ìš©ë¨, ì‹¤ì œ í…Œì´ë¸”ì— ì ìš© (username -> useernm ë“±ìœ¼ë¡œ íšŒì‚¬ ë£°ë¡œ ë°”ê¿€ ìˆ˜ ìˆìŒ)

ìŠ¤í”„ë§ ë¶€íŠ¸ ê¸°ë³¸ ì„¤ì •

`spring.jpa.hibernate.naming.implicit-strategy:org.springframework.boot.orm.jpa.hibernate.SpringImplicitNamingStrategy`

`spring.jpa.hibernate.naming.physical-strategy:org.springframework.boot.orm.jpa.hibernate.SpringPhysicalNamingStrategy`
