# API ê°œë°œ ê¸°ë³¸

![[assets/images/56cd3a5be7b279ba19837b854c0bdab1_MD5.png]]

controllerëŠ” MVCì˜ í™”ë©´ì„ ìœ„í•œ ì»¨íŠ¸ë¡¤ëŸ¬ë‹¤.
ìš”ì¦˜ì€ SPA, ì•± ë“± apië§Œì„ ìœ„í•œ ì„œë²„ ê°œë°œì´ ë§ìœ¼ë¯€ë¡œ api íŒ¨í‚¤ì§€ë¥¼ ë”°ë¡œ ë‘ì–´ ê°œë°œí•˜ëŠ” ê²ƒì´ ì¢‹ìŒ.
```java
@RestController
public void MemberApiController {}
```
`@RestController` ëŠ” `@ResponseBody`, `@Controller` ë‘ê°œë¥¼ í•©ì¹œê±°ì„.

## ë“±ë¡ API
```java
@PostMapping("/api/v1/members")  
public CreateMemberResponse saveMemberV1(@RequestBody @Valid Member member) {  
    Long id = memberService.join(member);  
    return new CreateMemberResponse(id);  
}
```
ì´ë ‡ê²Œ ë§Œë“¤ì—ˆì§€ë§Œ, `@Valid` ë¥¼ ì‚¬ìš©í•˜ê¸° ìœ„í•´ì„œ Entityì—
```java
public class Member {  
	// ...
  
    @NotEmpty(message = "ì´ë¦„ì€ í•„ìˆ˜ ê°’ì…ë‹ˆë‹¤")  
    private String name;  
}
```
ì´ë ‡ê²Œ javax @NotEmpty ì–´ë…¸í…Œì´ì…˜ ë¶™ì—¬ì¤Œ. í•˜ì§€ë§Œ, ì´ê±´ Entityì´ê¸° ë•Œë¬¸ì— ë‹¤ë¥¸ ê³³ì—ì„œ ì‚¬ìš©í•  ê²½ìš° `@NotEmpty` ê°€ í•„ìš”ì—†ì„ ìˆ˜ ìˆìœ¼ë¯€ë¡œ, í™”ë©´ìœ¼ë¡œ ë¶€í„° ë°›ëŠ” ë°ì´í„° ê²€ì¦ì€ Entityì—ì„œ í•˜ëŠ”ê²Œ ì¢‹ì§€ ì•ŠìŒ.
ê·¸ë¦¬ê³  `name` -> `username` ìœ¼ë¡œ ë³€ìˆ˜ ëª…ì´ ë³€ê²½ë˜ì—ˆë‹¤ê³  í•˜ë©´, api ìŠ¤íŒ© ìì²´ê°€ ë³€ê²½ë˜ê¸° ë•Œë¬¸ì— ë¬´ì²™ ì¢‹ì§€ ì•Šë‹¤.
API ìŠ¤íŒ©ì„ ìœ„í•œ ë³„ë„ DTOë¥¼ ë§Œë“¤ì–´ ì œê³µí•˜ëŠ”ê²Œ ì œì¼ ì¢‹ì€ ë°©ë²•ì´ë‹¤.
```java
@PostMapping("/api/v2/members")  
public CreateMemberResponse saveMemberV2(@RequestBody @Valid CreateMemberRequest request) {  
    Member member = new Member();  
    member.setName(request.getName());  
    Long id = memberService.join(member);  
    return new CreateMemberResponse(id);  
}  
  
@Data  
static class CreateMemberRequest {  
	@NotEmpty
    private String name;  
}
```
## ìˆ˜ì • API
```java {4}
@PutMapping("/api/v2/members/{id}")  
public UpdateMemberResponse updateMemberV2(@PathVariable("id") Long id,  
                                           @RequestBody @Valid UpdateMemberRequest request) {  
    memberService.update(id, request.getName());  
    Member findMember = memberService.findById(id);  
    return new UpdateMemberResponse(findMember.getId(), findMember.getName());  
}
``````java
@Transactional  
public void update(Long id, String name) {  
    Member member = memberRepository.findOne(id);  
    member.setName(name);  
}
```
`memberService.update()` ë¥¼ voidê°€ ì•„ë‹ˆë¼ Memberë¥¼ return í•˜ë„ë¡ í•  ìˆ˜ë„ ìˆìŒ. ê·¸ëŸ¼ ë”°ë¡œ ì¡°íšŒë¥¼ ì•ˆí•´ë„ ëœë‹¤.

í•˜ì§€ë§Œ, ì»¤ë§¨ë“œì„± ë©”ì„œë“œì™€ ì¿¼ë¦¬ì„± ë©”ì„œë“œë¥¼ ë”°ë¡œ ë¶„ë¦¬í•˜ëŠ”ê²Œ ì¢‹ìœ¼ë¯€ë¡œ, controllerë‹¨ì—ì„œ DB ì—…ë°ì´íŠ¸ ëœ ë°ì´í„°ë¥¼ ë‹¤ì‹œ ì¡°íšŒ í›„ return í•œë‹¤.

## ì¡°íšŒ API

### V1
```java
@GetMapping("/api/v1/members")  
public List<Member> members() {  
    return memberService.findAll();  
}
``````json
[
    {
        "id": 1,
        "name": "new-hello",
        "address": null,
        "orders": []
    },
    {
        "id": 2,
        "name": "fjenf",
        "address": {
            "city": "êµ¬",
            "street": "407í˜¸",
            "zipcode": "0641"
        },
        "orders": []
    },
    {
        "id": 3,
        "name": "test1",
        "address": {
            "city": "test",
            "street": "test",
            "zipcode": "101001"
        },
        "orders": []
    }
]
```
jsonì„ ë³´ë©´, `orders` ë°°ì—´ì´ í•¨ê»˜ ë„˜ì–´ì˜¤ê³  ìˆë‹¤. ì¦‰, Member Entityë¥¼ ì§ì ‘ ë…¸ì¶œí•˜ê³  ìˆëŠ” ê²ƒì„.
```java
@JsonIgnore  
@OneToMany(mappedBy = "member")  
private List<Order> orders = new ArrayList<>();
```
`@JsonIgnore` ì–´ë…¸í…Œì´ì…˜ ë¶™ì—¬ì£¼ë©´ ë…¸ì¶œì´ ë˜ì§€ ì•ŠìŒ. í•˜ì§€ë§Œ, ë‹¤ë¥¸ APIë¥¼ ë§Œë“¤ ë•Œ ë¬¸ì œê°€ ëœë‹¤. ì¦‰ Entityì— í™”ë©´ì— ì£¼ê¸° ìœ„í•œ ë¡œì§ì´ ë“¤ì–´ê°€ê²Œ ë˜ë²„ë ¸ë‹¤. ìœ ì§€ë³´ìˆ˜ê°€ êµ‰ì¥íˆ ì–´ë ¤ì›Œì§.

ğŸ“Œ v1 ë¬¸ì œì 
- ì—”í‹°í‹°ì— í”„ë ˆì  í…Œì´ì…˜ ê³„ì¸µì„ ìœ„í•œ ë¡œì§ì´ ì¶”ê°€ëœë‹¤.
- ê¸°ë³¸ì ìœ¼ë¡œ ì—”í‹°í‹°ì˜ ëª¨ë“  ê°’ì´ ë…¸ì¶œ
- ì‘ë‹µ ìŠ¤í™ì„ ë§ì¶”ê¸° ìœ„í•´ ë¡œì§ì´ ì¶”ê°€ëœë‹¤. (`@JsonIgnore`, ë³„ë„ì˜ ë·° ë¡œì§ ë“±)
- ì‹¤ë¬´ì—ì„œëŠ” ê°™ì€ ì—”í‹°í‹°ì— ëŒ€í•´ APIê°€ ìš©ë„ì— ë”°ë¼ ë‹¤ì–‘í•˜ê²Œ ë§Œë“¤ì–´ì§€ëŠ”ë°, í•œ ì—”í‹°í‹°ì— ê°ê°ì˜ APIë¥¼ ìœ„í•œ í”„ë ˆì  í…Œì´ì…˜ ì‘ë‹µ ë¡œì§ì„ ë‹´ê¸°ëŠ” ì–´ë ¤ì›€
- ì—”í‹°í‹°ê°€ ë³€ê²½ë˜ë©´ API ìŠ¤í™ì´ ë³€í•¨
- ì¶”ê°€ë¡œ ì»¬ë ‰ì…˜ì„ ì§ì ‘ ë°˜í™˜í•˜ë©´ í–¥í›„ API ìŠ¤í™ì„ ë³€ê²½í•˜ê¸° ì–´ë ¤ì›€. (ë³„ë„ì˜ Result í´ë˜ìŠ¤ ìƒì„±ìœ¼ë¡œ í•´ê²°)
ë”°ë¼ì„œ, API ì‘ë‹µ ìŠ¤í™ì´ ë§ì¶° ë³„ë„ì˜ DTOë¥¼ ë°˜í™˜í•œë‹¤.

> ì°¸ê³ : ì—”í‹°í‹°ë¥¼ ì™¸ë¶€ì— ë…¸ì¶œí•˜ì§€ ë§ˆì„¸ìš”!
> ì‹¤ë¬´ë„¤ì„œëŠ” `member` ì—”í‹°í‹°ì˜ ë°ì´í„°ê°€ í•„ìš”í•œ APIê°€ ê³„ì† ì¦ê°€í•˜ê²Œ ëœë‹¤. ì–´ë–¤ APIëŠ” `name` í•„ë“œê°€ í•„ìš”í•˜ì§€ë§Œ, ì–´ë–¤ APIëŠ” `name` í•„ë“œê°€ í•„ìš”ì—†ì„ ìˆ˜ ìˆë‹¤. ê²°ë¡ ì ìœ¼ë¡œ ì—”í‹°í‹° ëŒ€ì‹  API ìŠ¤í™ì— ë§ëŠ” ë³„ë„ì˜ DTOë¥¼ ë…¸ì¶œí•´ì•¼ í•¨.

ë˜ í•˜ë‚˜ì˜ ë¬¸ì œì ì€ json ìŠ¤í™ì— count ê°™ì€ ê²ƒì´ ë“¤ì–´ê°ˆ ê²½ìš°ë‹¤.
```json {2}
[
	"count":
    {
        "id": 1,
        "name": "new-hello",
        "address": null,
        "orders": []
    },
]
```
ì´ëŸ° ì‹ìœ¼ë¡œ ë“¤ì–´ê°ˆ ìˆ˜ ì—†ê¸° ë•Œë¬¸ì„.

### V2
```java
@GetMapping("/api/v2/members")  
public Result membersV2() {  
    List<Member> findMembers = memberService.findAll();  
    List<MemberDto> collect = findMembers.stream()  
            .map(m -> new MemberDto(m.getName()))  
            .collect(Collectors.toList());  
  
    return new Result(collect);  
}  
  
@Data  
@AllArgsConstructor  
static class Result<T> {  
    private T data;  
}  
  
@Data  
@AllArgsConstructor  
static class MemberDto {  
    private String name;  
}
```
`Result` classë¥¼ ë§Œë“¤ì–´ dataëŠ” ê·¸ìª½ ë°°ì—´ì— ë„£ì–´ì£¼ëŠ” í˜•íƒœë¡œ í•˜ë©´ json ìŠ¤í™ì—ë„ ì˜ ë§ìŒ.
```json
{
    "data": [
        {
            "name": "new-hello"
        },
        {
            "name": "í™©ì„ íƒœ"
        },
        {
            "name": "test1"
        }
    ]
}
```
MemberDtoëŠ” responseì— ë”± ë…¸ì¶œí•  ê²ƒë§Œ ì¤„ ìˆ˜ ìˆë‹¤.
