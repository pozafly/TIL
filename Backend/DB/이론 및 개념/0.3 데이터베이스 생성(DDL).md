# ë°ì´í„°ë² ì´ìŠ¤ ìƒì„±(DDL)

## SQL ê¸°ë³¸ ê°œë…

- Structured Query Language
- ì¢…í•©ì ì¸ DB ì–¸ì–´: DDL + DML + VDL

| relational data model |  SQL   |
|:-------------------: |:----: |
|       relation        | table  |
|       attribute       | column |
|         tuple         |  row   |
|        domain         | domain |

## ë°ì´í„°ë² ì´ìŠ¤ ìƒì„±í•˜ê¸°

```sql
create database company;
```

```sql
drop database company;
```

### Database vs Schema

- MySQLì—ì„œëŠ” Databaseì™€ Schemaê°€ ê°™ì€ ëœ»ì„ ì˜ë¯¸
- `create database company` = `create schema company`
- ë‹¤ë¥¸ DBì—ì„œëŠ” ì˜ë¯¸ê°€ ë‹¤ë¥´ê²Œ ì“°ì„
	- i.g.) postgresSQLì—ì„œëŠ” Schemaê°€ Databaseì˜ namespaceë¥¼ ì˜ë¯¸

## í…Œì´ë¸” ìƒì„±í•˜ê¸°

ë¶€ì„œ, ì‚¬ì›, í”„ë¡œì íŠ¸ ê´€ë ¨ DBë¥¼ ë§Œë“ ë‹¤.

<img width="1207" alt="Image" src="https://github.com/user-attachments/assets/cbf695c4-6883-4f6f-8f2c-800436eabf26" />

```sql
CREATE TABLE department (
	id int PRIMARY KEY,
	name varchar(20) NOT NULL UNIQUE,
	leader_id int
);

CREATE TABLE employee(
    id int PRIMARY KEY,
    name varchar(30) NOT NULL,
    birth_date date,
    sex char(1) CHECK(
        sex IN ('M', 'F')
    ),
    POSITION varchar(10),
    salary int DEFAULT 50000000,
    dept_id int,
    FOREIGN KEY(dept_id) REFERENCES department(id)
    ON DELETE SET NULL
    ON UPDATE CASCADE,

	CHECK (salary >= 50000000)
);

CREATE TABLE PROJECT(
    id int PRIMARY KEY,
    name varchar(20) NOT NULL UNIQUE,
    leader_id int,
    start_date date,
    end_date date,
    FOREIGN KEY (leader_id) REFERENCES employee(id)
    ON DELETE SET NULL 
    ON UPDATE CASCADE,
    CHECK(start_date < end_date)
);

CREATE TABLE WORKS_ON(
    empl_id int,
    proj_id int,
    PRIMARY KEY (empl_id, proj_id),
    FOREIGN KEY (empl_id) REFERENCES employee(id)
        ON DELETE CASCADE
        ON UPDATE CASCADE,
    FOREIGN KEY (proj_id) REFERENCES project(id)
        ON DELETE CASCADE
        ON UPDATE CASCADE
);
```

## attribute data type ì†Œê°œ

### ìˆ«ì

<img width="1421" alt="Image" src="https://github.com/user-attachments/assets/aff0a67d-fae8-4e0b-8fa4-e1323ab56655" />

### ë¬¸ìì—´

<img width="1392" alt="Image" src="https://github.com/user-attachments/assets/7eda7c84-3965-4b72-8ced-270e65ee30a0" />

### ë‚ ì§œ

<img width="1422" alt="Image" src="https://github.com/user-attachments/assets/4e2a2af0-1f99-43ee-bce1-0efa1950f0f7" />

### ê·¸ì™¸

<img width="1424" alt="Image" src="https://github.com/user-attachments/assets/b5014b7d-c832-4152-b623-555f627621de" />

## primary key ì„¤ì •í•˜ê¸°

- primay key: tableì˜ tupleì„ ì‹ë³„í•˜ê¸° ìœ„í•´ ì‚¬ìš©, í•˜ë‚˜ ì´ìƒì˜ attribute(s)ë¡œ êµ¬ì„±
- primary keyëŠ” ì¤‘ë³µëœ ê°’ì„ ê°€ì§ˆ ìˆ˜ ì—†ìœ¼ë©°, nullë„ ê°’ìœ¼ë¡œ ê°€ì§ˆ ìˆ˜ ì—†ìŒ.

### key constraints: primary key

- attribute í•˜ë‚˜ë¡œ êµ¬ì„±ë  ë•Œ

```sql
create table PLAYER (
  id int primary key,
  â€¦
);
```

- attribute í•˜ë‚˜ ì´ìƒìœ¼ë¡œ êµ¬ì„±ë  ë•Œ

```sql

create table PLAYER (
  team_id varchar(12),
  back_number int,
  ...
  primary key (team_id, back_number)
);
```

## unique constraint ì„¤ì •í•˜ê¸°

- uniqueë¡œ ì§€ì •ëœ ì–´íŠ¸ë¦¬ë·°íŠ¸ëŠ” ì¤‘ë³µëœ ê°’ì„ ê°€ì§ˆ ìˆ˜ ì—†ë‹¤.
- ë‹¨ nullì€ ì¤‘ë³µì´ ê°€ëŠ¥í•˜ë‹¤.

---

- attribute í•˜ë‚˜ë¡œ êµ¬ì„±ë  ë•Œ

```sql
create table PLAYER (
  id int unique,
  â€¦
);
```

- attribute í•˜ë‚˜ ì´ìƒìœ¼ë¡œ êµ¬ì„±ë  ë•Œ

```sql

create table PLAYER (
  team_id varchar(12),
  back_number int,
  â€¦
  unique (team_id, back_number)
);
```

## not null constraint ì„¤ì •í•˜ê¸°

- attributeê°€ not nullë¡œ ì§€ì •ë˜ë©´ attributeëŠ” nullì„ ê°€ì§ˆ ìˆ˜ ì—†ë‹¤.

```sql
create table STUDENT (
  ...
  phone_number int not null unique,
  ...
);
```

## attributeì˜ default ê°’ ì„¤ì •í•˜ê¸°

- ìƒˆë¡œìš´ tupleì„ ì €ì¥í•  ë•Œ í•´ë‹¹ attributeì— ëŒ€í•œ ê°’ì´ ì—†ë‹¤ë©´ default ê°’ìœ¼ë¡œ ì €ì¥

```sql
CREATE TABLE employee(
    ...
    salary int DEFAULT 50000000,
    ...
);
```

## check constraint ì„¤ì •í•˜ê¸°

- attributeì˜ ê°’ì„ ì œí•œí•˜ê³  ì‹¶ì„ ë•Œ ì‚¬ìš©

---

- attribute í•˜ë‚˜ë¡œ êµ¬ì„±ë  ë•Œ

```sql
CREATE TABLE employee(
  ...
  age int check (age >= 20),
);
```

```sql
CREATE TABLE employee(
  start_date DATE,
  end_date DATE,
  ...
  CHECK (start_date < end_date)
);
```

```sql
CREATE TABLE employee(
    ...
    sex char(1) CHECK(sex IN ('M', 'F')),
    CHECK (salary >= 50000000)
);
```

## foreign key ì„¤ì •í•˜ê¸°

```sql
create table EMPLOYEE(
  ...
  dept_id int,
  FOREIGN KEY (dept_id)
    references DEPARTMENT(id)
    on delete [reference_option]
    on update [reference_option]
);
```

| reference_option |               ì„¤ëª…               |
|:--------------: |:----------------------------: |
|     CASCADE      |     ì°¸ì¡° ê°’ì˜ ì‚­ì œ / ë³€ê²½ì„ ê·¸ëŒ€ë¡œ ë°˜ì˜      |
|     SET NULL     |    ì°¸ì¡° ê°’ì´ ì‚­ì œ / ë³€ê²½ ì‹œ nullë¡œ ë³€ê²½    |
|     RESTRICT     |     ì°¸ì¡° ê°’ì´ ì‚­ì œ / ë³€ê²½ ë˜ëŠ” ê²ƒì„ ê¸ˆì§€     |
|    NO ACTION     |          RESTRICTì™€ ìœ ì‚¬          |
|   SET DEFAULT    | ì°¸ì¡° ê°’ì´ ì‚­ì œ / ë³€ê²½ ì‹œ default ê°’ìœ¼ë¡œ ë³€ê²½ |

- cascade ê°™ì€ ê²½ìš°, ìƒìœ„ í…Œì´ë¸”ì˜ í–‰ì´ ì œê±°ë˜ë©´, í•˜ìœ„ í…Œì´ë¸”ì˜ í–‰ë„ ì‚­ì œë¨.
	- ìƒìœ„ id ê°’ì´ 20ìœ¼ë¡œ ë³€ê²½ë˜ë©´, í•˜ìœ„ ì™¸ë˜í‚¤ë„ 20ìœ¼ë¡œ ë³€ê²½ë¨.
	- ğŸ“Œ ë§Œì•½, í•˜ìœ„ ì™¸ë˜í‚¤ê°€ ë³€ê²½ëœë‹¤ë©´ ìƒìœ„ëŠ” ìë™ìœ¼ë¡œ ë³€ê²½ë˜ì§€ ì•ŠìŒ!

## constraint ì´ë¦„ ëª…ì‹œí•˜ê¸°

- ì´ë¦„ì„ ë¶™ì´ë©´ ì–´ë–¤ constraintë¥¼ ìœ„ë°˜í–ˆëŠ”ì§€ ì‰½ê²Œ íŒŒì•… ê°€ëŠ¥
- constraintë¥¼ ì‚­ì œí•˜ê³  ì‹¶ì„ ë•Œ í•´ë‹¹ ì´ë¦„ìœ¼ë¡œ ì‚­ì œ ê°€ëŠ¥

```sql
create table TEST (
  age int CONSTRAINT age_over_20 CHECK(age > 20)
);
```

- constraint age_over_20 ì´ë¦„ì„ ë¶™ì˜€ì„ ë•Œ
	- `Check constraint 'age_over_20' is violated.`
- constraint age_over_20 ì´ë¦„ì„ ìƒëµí–ˆì„ ë•Œ
	- `Check constraint 'test_chk_1' is violated.`

## í…Œì´ë¸” ë³€ê²½í•˜ê¸° (alter table)

department í…Œì´ë¸”ì˜ ê²½ìš° `leader_id` ëŠ” employeeì˜ idì´ë‹¤. ì¦‰, ì™¸ë˜í‚¤ë‹¤. í•˜ì§€ë§Œ, department í…Œì´ë¸”ì„ employee í…Œì´ë¸”ë³´ë‹¤ ë¨¼ì € ë§Œë“¤ì—ˆê¸° ë•Œë¬¸ì— ì™¸ë˜í‚¤ë¥¼ ê±¸ì–´ì£¼ì§€ ëª»í–ˆë‹¤.

alterë¡œ `leader_id` ë¥¼ ì™¸ë˜ í‚¤ë¡œ ë³€ê²½í•  ìˆ˜ ìˆë‹¤.

```sql
ALTER TABLE department ADD FOREIGN KEY (leader_id)
REFERENCES employee(id)
    ON UPDATE CASCADE
    ON DELETE SET NULL;
```

ì¦‰, tableì˜ schemaë¥¼ ë³€ê²½í•˜ê³  ì‹¶ì„ ë•Œ ì‚¬ìš©.

|       ìœ í˜•        |                         MySQL ì˜ˆì œ                         |
|:-------------: |:------------------------------------------------------: |
|  attribute ì¶”ê°€   |       `ALTER TABLE employee ADD blood VARCHAR(2);`       |
| attribute ì´ë¦„ ë³€ê²½ | `ALTER TABLE employee RENAME COLUMN phone TO phone_num;` |
| attribute íƒ€ì… ë³€ê²½ |   `ALTER TABLE employee MODIFY COLUMN blood CHAR(2);`    |
|   table ì´ë¦„ ë³€ê²½   |      `ALTER TABLE employee RENAME TO backend_logs;`      |
| primary key ì¶”ê°€  |         `ALTER TABLE log ADD PRIMARY KEY (id);`          |
|       â€¦       |                           â€¦                            |

â­ï¸ ì´ë¯¸ ì„œë¹„ìŠ¤ ì¤‘ì¸ tableì˜ schemaë¥¼ ë³€ê²½í•˜ëŠ” ê²ƒì´ë¼ë©´, ë³€ê²½ ì‘ì—… ë•Œë¬¸ì— ì„œë¹„ìŠ¤ì˜ ë°±ì—”ë“œì— ì˜í–¥ì´ ì—†ì„ì§€ ê²€í† í•œ í›„ ë³€ê²½í•˜ëŠ” ê²ƒì´ ì¤‘ìš”.

## í…Œì´ë¸” ì‚­ì œí•˜ê¸° (drop table)

```sql
DROP TABLE table_name;
```
