# 집계함수

## 집계 함수(Aggregate Functions)

여러 행의 값을 바탕으로 단일 결과 값을 계산한다. `GROUP BY` 절과 함께 사용됨.

| 함수                  | 설명                               |
| ------------------- | -------------------------------- |
| `AVG(expression)`   | 표현식의 평균값을 반환한다.                  |
| `COUNT(expression)` | 표현식의 결과가 `NULL` 이 아닌 행의 수를 반환한다. |
| `COUNT(*)`          | 테이블의 전체 행 수를 반환한다.               |
| `MAX(expression)`   | 표현식의 최댓값을 반환한다.                  |
| `MIN(expression)`   | 표현식의 최솟값을 반환한다.                  |
| `SUM(expression)`   | 표현식의 합계를 반환한다.                   |

### 전체 데이터 건수 파악하기: `COUNT()`

`COUNT()` 함수는 특정 컬럼의 행(row) 개수를 세는 가장 기본적인 집계 함수. `COUNT(*)` 는 **NULL 값에 상관없이 테이블의 모든 행의 개수**를 셈.

```sql
SELECT COUNT(*) FROM order_stat;
```

#### NULL과 특정 컬럼의 개수: `COUNT(컬럼)` vs `COUNT(*)`

방금 우리는 `COUNT(*)` 로 전체 주문이 11건이라는 것을 알아냈다. 그런데 여기서 또 다른 질문이 생긴다. "그러면, **카테고리가 등록된 주문**은 총 몇 건이지?"
11번째 데이터는 `category` 값이 `NULL` 이다. 즉, 카테고리 정보가 누락되었다. 이런 상황에서 전체 개수가 아닌, 특정 컬럼에 값이 실제로 존재하는 데이터의 개수만 세려면 어떻게 해야 할까? `COUNT(*)` 만으로는 이 문제를 해결할 수 없다.

**개념 비교: `COUNT(*)` vs `COUNT(컬럼명)`**

- `COUNT(*)`: 별표(`*`)는 '모든 컬럼'을 의미하며, 더 나아가 그냥 **'행 자체'** 를 가리킨다. 따라서 `COUNT(*)` 는 `NULL` 값의 존재 여부와 상관없이 **테이블의 물리적인 행의 개수**를 모두 센다. 마치 출석부의 총인원을 세는 것과 같다.
- `COUNT(컬럼명)`: 특정 컬럼 이름을 지정하면, 해당 컬럼의 값 중에서 **`NULL` 이 아닌 값의 개수만 센다.** `NULL` 은 '값이 없음'을 의미하므로 개수에서 제외되는 것이다. 이것은 출석부에서 이름이 실제로 적힌 학생 수만 세는 것과 같다.

#### 합계와 평균 계산으로 매출 분석하기: `SUM()`, `AVG()`

- `SUM(컬럼명)`: 지정한 숫자 컬럼의 모든 값을 더하여 **합계**를 계산한다.
- `AVG(컬럼명)`: 지정한 숫자 컬럼의 값들의 **평균**을 계산한다.
`SUM()` 과 `AVG()` 함수는 계산 과정에서 **NULL 값을 자동으로 제외**한다. `NULL` 을 `0` 으로 취급하지 않는다는 점.

```sql
SELECT
	SUM(price * quantity) AS `총 매출액`,
	AVG(price * quantity) AS `평균 주문 금액`
FROM
	order_stat;
```

### **최대**, **최소값으로** **상품** **전략** **세우기**: `MAX()`, `MIN()`

- `MAX(컬럼명)`: 지정한 컬럼에서 **최댓값**을 찾는다.
- `MIN(컬럼명)`: 지정한 컬럼에서 **최솟값**을 찾는다.

```sql
SELECT
	MAX(price) AS 최고가,
	MIN(price) AS 최저가
FROM
	order_stat;
```

### **고유** **고객** **수** **파악하기**: `DISTINCT`

중복된 값을 제외하고 순수한(고유한) 값의 개수.
`DISTINCT` 는 집계 함수와 함께 `COUNT(DISTINCT 컬럼명)` 형태로 사용할 수 있다. 이때는 특정 컬럼에서 중복을 제거한 뒤 개수를 센다.

```sql
SELECT
	COUNT(customer_name) AS `총 주문 건수`,
	COUNT(DISTINCT customer_name) AS `순수 고객 수`
FROM
	order_stat;
```

- `COUNT(customer_name)`: 중복을 포함하여 총 주문 건수인 11을 반환.
- `COUNT(DISTINCT customer_name)`: 고객 이름('이순신', '세종대왕', '신사임당', '장영실', '홍길동')에서 중복을 모두 제거하고 고유한 값들의 개수인 5를 반환.
