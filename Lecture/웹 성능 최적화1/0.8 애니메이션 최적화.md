# 애니메이션 최적화

![[assets/images/d709b21d0091faaf74d5b7bb9681d541_MD5.png]]

performance 탭에서 설정 버튼을 누르면, CPU 옵션을 조정할 수 있는 부분이 아농다. 거기서 6X 를 누르면 그만큼 느리게 CPU를 사용해 측정할 수 있다.

![[assets/images/1c67cfa0593e49321673d1fff89494f9_MD5.png]]

애니메이션은 width를 통해 값을 변화시키고 있다. 버벅임이 일어나고 있다.

브라우저는 애니메이션 원리는 이미지를 연속적으로 바뀌는 것으로 애니메이션 처리가 일어난다. 하나의 이미지가 없어지면, 버벅임이 일어난다. 이 버벅임을 `쟁크 현상`이라고 한다.

![[assets/images/c7d2b6d896186b00bebf2eb9c96b2044_MD5.png]]

초당 60 프레임을 나타내지못하면, 쟁크 현상이 발생한다.

브라우저는 CRP를 통해 렌더링 과정을 일어난다.

![[assets/images/d481c24568728256a180123c013dc5fb_MD5.png]]

따라서 쟁크 현상이 일어나보이지 않게 하려면, 초당 60프레임, 즉, 1프레임당 `0.016s` 에 하나를 그려야 한다.

![[assets/images/b1387439510363e633515a6fa09b7857_MD5.png]]

performance를 측정해보면, 스타일을 다시 계산하고, layout이 일어나며, paint가 다시 일어나는 것을 볼 수 있음.

![[assets/images/4e871dc84b87ad87a0414edaa1badd20_MD5.png]]

점선을 보면, 점선 전에 commit 과정이 일어나야 브라우저가 누락되지 않은 화면을 보여줄 수 있다. 어떻게 이 과정을 땡길 수 있을까? 바로, 브라우저에 부담을 덜 주는 Layout, Paint 과정을 실행시키지 않게끔 하는 것이다.

- width, height가 변경되면
  - DOM + CSSOM = RenderTree, Layout, Paint, Composite 과정이 다시 실행된다. 이걸 reflow라고 함.
- color, background가 변경되면
  - DOM + CSSOM = RenderTree는 다시 만들긴 하지만, Layout 과정이 생략이 된다. 위치와 관련된 속성이 변경되지 않았기 때문임.

![[assets/images/557517438132b9f533c9943a8cb403f0_MD5.png]]

Repaint만 실행하는 것이다.

여기서 Repaint도 피할 수 있는 방법이 있다. `transform`, `opacity` 속성을 사용해 GPU가 관여할 수 있도록 해주는 것이다.

![[assets/images/1668019f5c08a0073003cb657178de35_MD5.png]]

<br/>

## 실습
```jsx
const Bar = (props) => {
  return (
    // ...
    <BarGraph width={props.percent} isSelected={props.isSelected}></BarGraph>
  );
};

const BarGraph = styled.div`
  width: ${({ width }) => width}%;
  transition: width 1.5s ease;
  z-index: 1;
  // ...
`;
```
width 속성으로 css-in-js를 통해 width 값을 조정하고 있다. 이 때, width 값을 계속해서 변경시키는게 아니라 `transform` 속성을 사용해 GPU를 통해 변경시키도록 해보자.
```jsx
const BarGraph = styled.div`
  width: 100%;
  transform: scaleX(${({ width }) => width / 100});
  transform-origin: center left;
  transition: transform 1.5s ease;
  z-index: 1;
  // ...
`;
```
이렇게 변경시켜 주었음. `/100` 해주는 이유는, width가 % 였기 때문이다.

`transform-origin` 값은 transform 값을 어디다 기준을 둘 것인지를 설정해줄 수 있는 값이다. 즉, 변환의 원점을 설정하는 것임. default값은 `center` 임.

![[assets/images/e97e3e7764104971c70af53657bf3d94_MD5.png]]

프레임 드랍이 일어나지 않는다. 또, 보라색 부분을 보면, 보라색은 메인 쓰레드에서 작업하는 작업 량이다. transform으로 변경 후 거의 드롭이 없는 것을 볼 수 있다.
