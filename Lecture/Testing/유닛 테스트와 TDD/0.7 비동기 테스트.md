#Testing, #Jest 

[Repo](https://github.com/pozafly/Jest-Example)

```js
function fetchProduct(error) {
  if (error === 'error') {
    return Promise.reject('network error');
  }
  return Promise.resolve({ item: 'Milk', price: 200 });
}

module.exports = fetchProduct;
```

ì´ëŸ° ì½”ë“œë¥¼ í…ŒìŠ¤íŠ¸ í•˜ì.

```js
it('async', () => {
  fetchProduct().then((item) => {
    expect(item).toEqual({ item: 'Milk', price: 200 });
  });
});
```
í…ŒìŠ¤íŠ¸ í•˜ë©´, ì˜ í†µê³¼ê°€ ëœë‹¤. Object í˜•ì‹ì´ return ë  ê²ƒì´ê¸° ë•Œë¬¸ì— `toEqual` í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•¨. item ì´ë¦„ì„ 'Milk' ê°€ ì•„ë‹ˆê³ , 'PPP' ë¼ê³  í•´ë³´ì. `expect(item).toEqual({ item: 'PPP', price: 200 });` 

> [UnhandledPromiseRejection: This error originated either by throwing inside of an async function without a catch block, or by rejecting a promise which was not handled with .catch(). The promise rejected with the reason 

ì´ëŸ° warningì´ ëœ¬ë‹¤. í•˜ì§€ë§Œ í…ŒìŠ¤íŠ¸ëŠ” ì •ìƒì ìœ¼ë¡œ ë˜ì—ˆë‹¤. ì´ìƒí•˜ë‹¤. PPP ì¸ë°ë„ í†µê³¼ê°€ ë˜ì—ˆê¸° ë•Œë¬¸ì„.
ë‹¤ì‹œ ë§í•˜ë©´ jestì—ì„œëŠ” í†µê³¼ê°€ ë˜ì—ˆì§€ë§Œ promise ë‚´ë¶€ì—ì„œëŠ” warningì´ ëœ¬ ê²ƒ.

ì‚´í´ë³´ì. `fetchProduct` í•¨ìˆ˜ëŠ” ë¹„ë™ê¸° ì½”ë“œì´ê¸° ë•Œë¬¸ì— .then ì ˆì´ ì˜¤ê¸° ì „ì— it í•¨ìˆ˜ëŠ” ëì´ ë‚œë‹¤. ê·¸ëŸ¬ë©´ jest ì…ì¥ì—ì„œëŠ” it í•¨ìˆ˜ê°€ ë³„ë„ì˜ ì—ëŸ¬ ì—†ì´ ì˜ í†µê³¼ ë˜ì—ˆê¸° ë•Œë¬¸ì— expect ì—†ì´ PASS ë¡œ ì¸ì‹í•˜ëŠ” ê²ƒì´ë‹¤.

ìš°ë¦¬ê°€ ì›í•˜ëŠ” ê²ƒì€ fetchProduct í•¨ìˆ˜ê°€ .thenì„ í†µí•´ ë¹„ë™ê¸° ì½”ë“œê°€ ì™„ë£Œ ëœ ë‹¤ìŒ, expect í•¨ìˆ˜ë¥¼ ê±°ì³ í…ŒìŠ¤íŠ¸ ì™„ë£Œ í›„ it í•¨ìˆ˜ë¥¼ ì¢…ë£Œ ì‹œí‚¤ëŠ” ê²ƒì´ë‹¤.

## í•´ê²° ë°©ë²•(ë¹„ë™ê¸° ì½”ë“œê°€ ëë‚˜ëŠ” ì‹œì ì„ jestì—ê²Œ ì•Œë ¤ì£¼ê¸°)

### done ë°©ì‹
```js
it('async - done', (done) => {  // ğŸ”¥
  fetchProduct().then((item) => {
    expect(item).toEqual({ item: 'PPP', price: 200 });
    done();  // ğŸ”¥
  });
});
```
ğŸ”¥ doneì„ ì¸ìë¡œ ë°›ì•„, ëë‚˜ëŠ” ì‹œì ì— done() í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•´ì£¼ê¸°. ê·¸ëŸ¬ë©´ PPP ì´ë¯€ë¡œ testê°€ ì‹¤íŒ¨í•˜ê³ , Milkë¡œ ë°”ê¿”ì£¼ë©´ ë‹¤ì‹œ ì„±ê³µ í•¨.

í•˜ì§€ë§Œ ì•½ê°„ ì½”ë“œê°€ ë”ëŸ¬ì›Œ ë³´ì„.

### return ë°©ì‹
```js
it('async - return', () => {
  return fetchProduct().then((item) => {  // ì•„ì˜ˆ ë¦¬í„´í•´ë²„ë¦¼
    expect(item).toEqual({ item: 'Milk', price: 200 });
  });
});
```
ê·¸ëƒ¥ promiseë¥¼ ë¦¬í„´ í•´ì£¼ë©´ ëœë‹¤.

ì´ë ‡ê²Œ 2ê°€ì§€ ë°©ì‹ì´ ìˆëŠ”ë° doneì€ ì‹œê°„ì´ í›¨ì”¬ ì˜¤ë˜ê±¸ë¦°ë‹¤ëŠ” ë‹¨ì ì´ ìˆë‹¤. return ë°©ì‹ìœ¼ë¡œ ì‚¬ìš©í•˜ë„ë¡ í•˜ì.
<img width="269" alt="image" src="https://user-images.githubusercontent.com/59427983/194762824-f81142bf-261b-4081-b8f0-6b98717e8f92.png">

### async await ë°©ì‹
```js
it('async - await', async () => {
  const product = await fetchProduct();
  expect(product).toEqual({ item: 'Milk', price: 200 });
});
```


---


### resolves ê²€ì‚¬
```js
it('async - resolves', () => {
  return expect(fetchProduct()).resolves.toEqual({
    item: 'Milk',
    price: 200,
  });
});
```
expectë¥¼ return í•´ì£¼ê³ , resolves ë¼ëŠ” jest í•¨ìˆ˜ë¥¼ ì²´ì´ë‹ ê±¸ì–´ì£¼ë©´ ëœë‹¤.

### reject ê²€ì‚¬
```js
it('async - rejects', () => {
  return expect(fetchProduct('error')).rejects.toBe('network error');
});
```
ì´ë²ˆì—” resolves ëŒ€ì‹ , rejects ë¥¼ ì²´ì´ë‹ì„ ê±¸ì–´ì£¼ê³ , reject ëœ ë¬¸êµ¬ë¥¼ ì¨ì£¼ë©´ ëœë‹¤.